#硬件/gi访问/gi技术/gi
驱动程序/gi控制/vn设备/gi，/w主要/b是/vshi通过/p访问/gi设备/gi内/f的/ude1寄存器/gi来/vf达到/v控制/vn目的/gi。/w因此/c访问/gi硬件/gi的/ude1实质/gi就是/v访问/gi与/cc该/rz硬件/gi相关/vn的/ude1寄存器/gi。/w /x访问/gi流程/gi为/p：/w地址映射/gi：/w在/plinux/gi系统/gi中/f，/w无论是/c内核/gi程序/gi还是/c应用程序/nz，/w都/d只能/v使用/gi虚拟地址/gi，/w而/cc芯片手册/gi中/f给出/v的/ude1硬件/gi寄存器/gi地址/gi或者/cram/nz地址/gi则/d是/vshi物理地址/gi，/w无法/v直接/ad使用/gi。/w因此/c，/w我们/rr读写/gi寄存器/gi的/ude1第一步/nz就是/v将/d它/rr的/ude1物理地址/gi映射/gi为/p虚拟地址/gi。/w /x地址映射/gi的/ude1方法/gi有/vyou两/nz种/q，/w一种/nz是/vshi动态/gi映射/gi，/w一种/nz是/vshi静态/gi映射/gi（/w推荐/gi使用/gi动态/gi映射/gi）/w。/w /x动态/gi映射/gi，/w是/vshi指/v在/p驱动程序/gi中/f采用/vioremap/nz函数/gi将/d物理地址/gi映射/gi为/p虚拟地址/gi。/w /x静态/gi映射/gi，/w是/vshi指/vlinux/gi系统/gi根据/p用户/gi事先/d指定/v的/ude1映射/gi关系/gi，/w在/p内核/gi启动时/l，/w自动/d地/ude2将/d物理地址/gi映射/gi为/p虚拟地址/gi。/w静态/gi映射/gi是/vshi通过/pmap/nz_/nzdesc/nz结构/gi来/vf指明/v物理地址/gi与/cc虚拟地址/gi的/ude1映射/gi关系/gi。/w该/rz结构/gi为/p：/w其中/rzpfn/nz可以/v通过/p函数/gi_/nz_/nzphys/nz_/nzto/nz_/nzpfn/nz(/nz物理地址/gi)/nz来/vf计算/gi出/vf物理地址/gi所在/n的/ude1物理/n页帧/nz号/q。/w在/p完成/v地址映射/gi后/f，/w就/d可以/v读写/gi寄存器/gi了/ule。/wlinux/gi内核/gi提供/v了/ule一系列/b函数/gi，/w来/vf读写/gi寄存器/gi：/w其中/rz较为/d常用/a的/ude1是/vshi：/w分别/d表示/v读/v//nz写/v8/nz位/q寄存器/gi或/c16/nz位/q寄存器/gi或/c32/nz位/q寄存器/gi