#多线程/gi并发/gi编程/gi之/uzhi原子/gi变量/gi与非/c阻塞/vn同步/gi机制/gi
1./nz非/b阻塞/vn算法/gi非/b阻塞/vn算法/gi属于/v并发/gi算法/gi，/w它们/rr可以/v安全/gi地/ude2派生/v它们/rr的/ude1线程/gi，/w不/d通过/p锁定/v派生/v，/w而是/c通过/p低级/a的/ude1原子性/nz的/ude1硬件/gi原生/b形式/gi /x―/w―/w /x例如/v比较/gi和/cc交换/gi。/w非/b阻塞/vn算法/gi的/ude1设计/gi与/cc实现/gi极为/d困难/an，/w但是/c它们/rr能够/v提供/v更好/d的/ude1吞吐率/nz，/w对/p生存/vi问题/gi（/w例如/v死锁/gi和/cc优先级/n反转/gm）/w也/d能/v提供/v更好/d的/ude1防御/gi。/w使用/gi底层/n的/ude1原子化/n机器指令/gi取代/v锁/v,/nz比如/v比较/gi并/cc交换/gi(/nzcas/nz,/nzcompare/nz-/nzand/nz-/nzswap/nz)/nz./nz2./nz悲观/a技术/gi独占锁/nz是/vshi一种/nz悲观/a的/ude1技术/gi./nz它/rr假设/gi最坏/gi的/ude1情况/n发生/v(/nz如果/c不/d加锁/gi,/nz其它/rz线程/gi会/v破坏/v对象/gi状态/gi)/nz,/nz即使/c没有/v发生/v最坏/gi的/ude1情况/n,/nz仍然/d用/p锁/v保护/gi对象/gi状态/gi./nz3./nz乐观/a技术/gi依赖/v冲突/gi监测/vn./nz先/d更新/gi,/nz如果/c监测/vn发生冲突/n发生/v,/nz则/d放弃/gi更新/gi后/f重试/gi,/nz否则/c更新/gi成功/a./nz现在/t处理器/gi都/d有/vyou原子化/n的/ude1读-改-写/nz指令/gi,/nz比如/v比较/gi并/cc交换/gi(/nzcas/nz,/nzcompare/nz-/nzand/nz-/nzswap/nz)/nz./nz4./nzcas/nz操作/gicas/nz有/vyou3/nz个/q操作/gi数/n，/w内存/gi值/nv/nz，/w旧/a的/ude1预期/gi值/na/nz，/w要/v修改/gi的/ude1新值/nzb/nz。/w当/p且/c仅/d当/p预期/gi值/na/nz和/cc内存/gi值/nv/nz相同/a时/qt，/w将/d内存/gi值/nv/nz修改/gi为/pb/nz，/w否则/c什么/ry都/d不/d做/v。/wcas/nz典型/n使用/gi模式/gi是/vshi：/w首先/d从/pv/nz中/f读取/gia/nz，/w并/cc根据/pa/nz计算/gi新值/nzb/nz，/w然后/c再/d通过/pcas/nz以/p原子/gi方式/n将/dv/nz中的/v值/n由/pa/nz变成/vb/nz（/w只要/c在/p这/rzv期间/f没有/v任何/rz线程/gi将/dv/nz的/ude1值/n修改/gi为/p其他/rzv值/n）/w。/w清单/n /x3./nz /x说明/v比较/gi并/cc交换/gi的/ude1行为/n（/w而/cc不是/c性能/gi）/w的/ude1代码/gi清单/n /x4./nz /x使用/gi比较/gi并/cc交换/gi实现/gi计数器/gi5./nz原子/gi变量/gi原子/gi变量/gi支持/v不用/d锁/v保护/gi就/d能/v原子性/nz更新/gi操作/gi，/w其/rz底层/n用/pcas/nz实现/gi。/w共有/v12/nz个/q原子/gi变量/gi，/w可/v分为/v4/nz组/n：/w标量/n类/gi、/w更新/gi器类/nz、/w数组/gi类/gi以及/cc复合/vn变量/gi类/gi。/w最/d常用/a的/ude1原子/gi变量/gi就是/v标量/n类/gi：/watomicinteger/nz、/watomiclong/nz、/watomicboolean/nz以及/ccatomicreference/nz。/w所有/b类型/gi都/d支持/vcas/nz。/w6./nz性能/gi比较/gi：/w锁/v与/cc原子/gi变量/gi在/p中低/j程度/n的/ude1竞争/vn下/f，/w原子/gi变量/gi能/v提供/v很高/d的/ude1可伸缩性/l，/w原子/gi变量/gi性能/gi超过/v锁/v；/w而/cc在/p高强度/nz的/ude1竞争/vn下/f，/w锁/v能够/v更/d有效地/nz避免/v竞争/vn，/w锁/v的/ude1性能/gi将/d超过/v原子/gi变量/gi的/ude1性能/gi。/w但/c在/p更/d真实/a的/ude1实际/n情况/n中/f，/w原子/gi变量/gi的/ude1性能/gi将/d超过/v锁/v的/ude1性能/gi。/w