#自定义/nzHive Sql Job/nz分析/gi工具/gi
前言/gi我们/rr都/d知道/v,/nz在/p大数据/gi领域/gi,/nzhive/gi的/ude1出现/v帮/v我/rr降低/v了/ule许多/m使用/gihadoop/gi书写/v方式/n的/ude1学习/gi成本/n./nz使用/gi用户/gi可以/v使用/gi类似/asql/gi的/ude1语法/gi规则/gi写明/v查询/gi语句/gi,/nz从/phive/gi表/n数据/gi中/f查询/gi目标/gi数据/gi./nz最为/d重要/a的/ude1是/vshi这些/rzsql语句/gi会/v最终/d转化/gi为/pmap reduce/nz作业/gi进行/vn处理/vn./nz这/rzv也/d是/vshihive/gi最/d强大/a的/ude1地方/n./nz可以/v简单/a的/ude1理解/gi为/phive/gi就是/v依托/v在/phadoop/gi上/f的/ude11/nz个/q壳/ng./nz但是/c这里/rzs有一点/nz点/gi小小的/z不同/a,/nz不是/c每段/rhive/gi查询/gisql语句/gi与/cc最后/f生成/v的/ude1job/nz一一对应/gm,/nz如果/c你/rr的/ude1这段/rsql/gi是/vshi一个/mq大/asql/gi,/nz他/rr在/p转化/gi掉/v之后/f,/nz会/v衍生/vn出许/nz多/a小/ajob/nz,/nz这些/rz小/ajob/nz是/vshi独立/a存在/v运行/gi的/ude1,/nz以/p不同/a的/ude1job/nz名称/n进行/vn区别/gi,/nz但是/c也/d会/v保留/v公共/b的/ude1job/nz名称/n./nz所以/c一个/mq问题/gi来/vf了/ule,/nz对于/p超级/b长/a的/ude1hive sql/nz语句/gi,/nz我/rr想/v查看/gi到底/d是/vshi哪/ry段子/nsql/gi花费/v了/ule我/rr大量/m的/ude1执行/v时间/gi,/nz在/pjobhistory/nz上/f只有/c每个/r子/ngjob/nz的/ude1运行时间/gi,/nz没有/v子/ngjob/nz对应/vi的/ude1sql语句/gi,/nz一旦/d这个/rz功能/gi有/vyou了/ule之后/f,/nz就/d会/v帮助/v我们/rr迅速/ad的/ude1定位/gi到/v问题所在/i./nzhive/gi子/ngjob/nz中的/vsqlok/nz,/nz带着/vn上述/b的/ude1目标/gi,/nz我们/rr要/v想/v分析/gi出/vf到底/d哪/ry段子/nsql/gi所/usuo衍生/vn的/ude1job/nz运行时间/gi更长/d,/nz就要/d先/d知道/v这些/rzsql/gi到底/d在/p存在/v与/cc哪里/rys./nz在/p前面/f的/ude1描述/gi中/f,/nz已经/d提到/v了/ule,/nzhive/gi是/vshi依托/v于/phadoop/gi,/nz自然/nhive/gi提交/gi的/ude1job/nz信息/gi也/d是/vshi保存/gi在/phadoop/gi的/ude1hdfs/gi上/f的/ude1./nz在/p联想/vi一下/mjobhistory/nz中的/v各个/rz文件类型/nz./nz你/rr应该/v会/v发现/v带有/v下面/f后缀/n的/ude1文件/gi存在/v./nz我们/rr发现/v里面/f包含/v了/ule之前/f分析/gi过/uguo的/ude1./nzjhist/nz文件/gi,/nz还有/v带/vconf/nz字符/gi的/ude1./nzxml/nz格式文件/nz,/nz从文件/l名上/ns来看/u就是/vjob/nz提交/gi时/qt的/ude1一些/m配置/gi信息/gi,/nz然后/c我们/rr用/pvim/nz命令/gi查阅/vconf/nz./nzxml/nz后缀/n的/ude1文件/gi,/nz看看/v里面/f是不是/v有/vyou我们/rr想要/v的/ude1hive qury string /nz这样/rzv的/ude1属性/giok/nz,/nz目标/gi算是/v找到/v了/ule,/nz这/rzv的确/d就是/v我们/rr想要/v的/ude1属性/gi./nz说明/v这样/rzv的/ude1信息/gi的确/d是/vshi存在/v的/ude1,/nz后面/f的/ude1操作/gi就是/v怎么/ryv去/vf解析/gi这段/r有/vyou用/p的/ude1信息/gi了/ule./nz程序/gi工具/gi分析/gihive sql job/nz知道/v了/ule目标/gi数据源/gi,/nz我们/rr能/v想到/v的/ude1最简单/nz快速/d的/ude1方法/gi就是/v逐行/gi解析/gi文件/gi,/nz做/v做/v文本/gi匹配/gi,/nz筛选/v关键/n信息/gi./nz这些/rz代码/gi谁/ry都会/n写/v,/nz首先/d要/v传入/gi一个/mqhdfs/gi目录/gi地址/gi,/nz这个/rz是/vshi在/pjobhistory/nz的/ude1存储/gi目录/gi上/f加上/v一个/mq具体/a日期/gi目录/gi,/nz这段/r解析/gi程序/gi在/p文章/gi的/ude1末尾/n会/v加上/v./nz下面/f列举/v在/p调试/gi分析程序/n时/qt遇到/v的/ude1一些/m问题/gi,/nz这个/rz还是/c比较/gi有/vyou用/p的/ude1./nz1./nzhive sql/nz中的/v中文/gi导致/gi解析/gi出现/v乱码/nz这个/rz又是/c非常/d讨厌/v的/ude1java/gi解析/gi出现/v乱码/nz的/ude1原因/n,/nz因为/c考虑到/vsql/gi中/f存在/v中文/gi注释/gi,/nz而/cchadoop/gi在/p存/v中文/gi的/ude1时候/n都/d是/vshi用/putf/nz8/nz的/ude1编码方式/nz,/nz所以/c读出/v文件/gi数据/gi后/f进行/vn一次/nz转/vutf-8/gi编码方式/nz的/ude1处理/vn,/nz就是/v下面/f所示/nz代码/gi./nz2./nz单线/n程解析/nz文件/gi速度/n过慢/nz之前/f在/p测试环境/nz中/f做/v文件/gi解析/gi看不出/v真实/a效果/gi,/nz文件/gi一下/m解析/gi就/dok/nz了/ule,/nz但是/c到/v真实/a环境/n中/f,/nz多达/v几/d万/nz个/qjob/nz文件/gi,/nz程序/gi马上/d就/d吃不消/vl了/ule,/nz算上/nz解析/gi文件/gi,/nz再/d把/pba结果/n写入/gimysql/gi,/nz耗时/vi达到/v60/nz多/a分钟/qt,/nz后面/f改成/v了/ule多线程/gi的/ude1方式/n,/nz后来/t开到/v10/nz个/q线程/gi去/vf跑/v,/nz速度/n才/d快/a了/ule许多./nz3./nz结果/n数据/gi写入/gimysql/gi过慢/nz后来/t处理速度/n是/vshi上去/vf了/ule,/nz但是/c写入/gisql/gi速度/n过慢/nz,/nz比如说/vl,/nz我/rr有/vyou一次/nz测试/gi,/nz开/v10/nz个/q线程/gi区/n解析/gi,/nz花/n了/ule8/nz分钟/qt就/d解析/gi好/a了/ule几/d万/nz个/q文件/gi数据/gi,/nz但是/c插入/gi数据库/gi花/n了/ule20/nz分钟/qt左右/f,/nz而且/c量/n也/d就/d几/d万条/q语句/gi./nz后来/t改成/v了/ule批处理/gi的/ude1方式/n,/nz效果/gi并/cc没有/v什么/ry大/a的/ude1改变/v,/nz这个/rz慢/a的/ude1问题/gi具体/a并/cc没有/v被/pbei解决/v掉/v,/nz怀疑/v可能/v是/vshi因/p有些/rz语句/gi中/f存在/v超长/b的/ude1hive sql/nz语句/gi导致/gi的/ude1./nz下面/f是/vshi程序/gi的/ude1主要/b分析/gi代码/gi,/nz分为/v工具/gi类/gi代码/gi,/nz和/cc解析线/nz程类/nz,/nz代码/gi全部/m链接/gi再/d此处/s:/w主/ag工具/gi代码/gi解析/gi线程/gi代码/giparsethread/nz./nzjava/gi:/w其他/rzv更多/adyarn/nz,/nzhadoop/gi方面/n代码/gi的/ude1分析/gi请/v点击/v链接/gi,/nz后续/vn将/d会/v继续/v更新/giyarn/nz其他/rzv方面/n的/ude1代码/gi分析/gi。/w