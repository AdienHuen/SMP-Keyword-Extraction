#【/w数据库/gi】/wSQL/nz注入/gi攻击/gi
背景/n：/w  /x机房收费系统/gi验收/vn的/ude1时候/n，/w师父/n提到/vsql注入/gi攻击/gi。/w自己/rr以前/f看过/v类/gi的/ude1博客/gi大概/d知道/v一/nz些/q这/rzv方面/n的/ude1事情/n，/w于是/cc自己/rr动手/gi查/v了/ule查/v。/w定义/gi：/w  /x所谓/vsql注入/gi，/w通过/psql/gi命令/gi插入/gi到/vweb表单/gi提交/gi或者/c输入/v域名/gi或/c页面/gi请求/gi的/ude1查询/gi字段/gi，/w达到/v欺骗/v服务器/gi执行/v恶意/n的/ude1sql/gi命令/gi。/w  /x这样/rzv说/v大家/rr可能/v对/p这个/rz理解/gi不是/c特别/d深刻/a，/w下面/f我/rr就/d举一个/nz生活/vn中的/v小/a例子/gi，/w大家/rr一/nz看/v就/d明白/v了/ule。/w             /x这/rzv是/vshi一/nz张/q相当/d有/vyou技术含量/nz的/ude1车牌/n遮挡/v，/w其/rz对/p交警/nnd系统/gisql injection/nz的/ude1hack/nz案例/gi。/w当/p摄像头/gi拍到/v这个/rz车牌号/nz，/w并/cc转换成/i文本/gi时/qt，/w插入/gi数据库/gi的/ude1sql注入/gi。/w可能会/nz执行/v该/rzsql语句/gi，/w然后/c删除/gi掉/v关于/p这个/rz车/n的/ude1信息/gi。/w这/rzv就是/v一个/mq小/a的/ude1sql注入/gi。/w大家/rr可以/v想象/v程序员/gi不是/c“/w好/a惹”/nz的/ude1吧/y！/w分类/gi：/w  /x关于/psql注入/gi可以/v分为/v平台/gi层/gi注入/gi和/cc代码/gi层/gi注入/gi。/w其中/rz平台/gi层/gi注入/gi由/p不/d安全/gi的/ude1数据库/gi配置/gi或/c数据库/gi平台/gi的/ude1漏洞/n所致/nz；/w代码/gi层/gi注入/gi主要/b由于/p程序员/gi对/p输入/v未/d进行/vn细致/a的/ude1过滤/gi，/w从而/c执行/v了/ule非法/b的/ude1数据/gi查询/gi。/w产生/v原因/n：/w1/nz、/w不当/a的/ude1类型/gi处理/vn。/w2/nz、/w不/d安全/gi的/ude1数据库/gi配置/gi。/w3/nz、/w不合理/nz的/ude1查询/gi集/q处理/vn。/w4/nz、/w不当/a的/ude1错误处理/i。/w5/nz、/w转义字符/gi处理/vn不/d合适/a。/w6/nz、/w多/a个/q提交/gi处理不当/l。/w攻击/gi步骤/gi：/w  /x发现/vsql注入/gi位置/gi―/w―/w判断/gi后台/gi的/ude1数据库/gi类型/gi―/w―/w确定/vxp/nz_/nzcmdshell/nz（/wxp/nz_/nzcmdshell /nz扩展/gi存储过程/gi将/d命令/gi字符串/gi作为/p操作系统/gi命令/gi shell /nz执行/v，/w并以/c文本/gi行/ng的/ude1形式/gi返回/v所有/b输出/gi。/w）/w可执行/nz情况/n―/w―/w发现/vweb/gi虚拟目录/nz―/w―/w上传/vasp/nz木马/gi（/w它/rr是/vshi用/pasp/nz编写/gi的/ude1网站/gi程序/gi。/w它/rr和/cc其它/rzasp/nz程序/gi没有/v本质区别/n，/w只要/c是/vshi能/v运行/giasp/nz的/ude1空间/n就/d能/v运行/gi它/rr，/w这种/r性质/n使得/viasp/nz木马/gi非常/d不易/ad被/pbei发觉/v。/w）/w―/w―/w得到/v管理员/gi权限/gi―/w―/wsql/gi注入式/n攻击/gi（/w详细/gi见/v：/w）/w如/v图/gi为/psql注入/gi攻击/gi过程/gi：/w         /x防/vsql注入/gi攻击/gi过程/gi：/w              /x现阶段/t的/ude1应对/v方法/gi，/w从/p安全/gi技术手段/n上/f来说/uls，/w可以/v通过/p数据库/gi防火墙/gi实现/gi对/psql注入/gi攻击/gi的/ude1防范/gi，/w因为/csql注入/gi攻击/gi往往/d是/vshi通过/p应用程序/nz来/vf进攻/vn，/w可以/v使用/gi虚拟/gi补丁/gi技术/gi实现/gi对/p注入/gi攻击/gi的/ude1sql/gi特征/gi识别/gi，/w实现/gi实时/n攻击/gi阻断/v。/w君子/n不/d立/v危墙/nz之下/f：/w  /x在/p这个/rz大数据时代/gi，/w信息/gi侵入/v防不胜防/vl，/w我们/rr要/v做/v的/ude1就是/v尽可能/d防止/gi产生/vsql注入/gi攻击/gi。/w所以/c要/v遵循/gi几/d条/q非常/d基本/a的/ude1规则/gi：/w1/nz、/w在/p构造/n动态/gisql语句/gi是/vshi，/w一定/b要/v使用/gi类/gi安全/gi（/wtype/nz-/nzsafe/nz）/w的/ude1参数/gi加码/vi机制/gi。/w2/nz、/w在/p部署/gi应用/gi之前/f，/w始终/d要/v做/v安全/gi审评/v（/wsecurity review/nz）/w。/w3/nz、/w千万别/i把/pba敏感性/gi数据/gi在/p数据库/gi里/f以/p明文/n存放/v。/w4/nz、/w确认/v你/rr编写/gi了/ule自动化/gi的/ude1单元测试/gi，/w来/vf特别/d校验/v你/rr的/ude1数据访问层/gi和/cc应用程序/nz不受/vsql注入/gi攻击/gi。/w5/nz、/w锁定/v你/rr的/ude1数据库安全/gi，/w只/d给/p访问/gi数据库/gi的/ude1web应用/gi功能/gi所需/nz的/ude1最低/a的/ude1权限/gi。/w6/nz、/w很/d多/a新手/gi从/p网上/s下载/gisql/gi通用/gi防/v注入/gi系统/gi的/ude1程序/gi，/w在/p需要/v防范/gi注入/gi的/ude1页面/gi头部/n用来/v防止/gi别人/rr进行/vn手动/b注入/gi测试/gi。/w7/nz、/w对于/p注入/gi分析器/n的/ude1防范/gi，/w笔者/n通过/p实验/gi，/w发现/v了/ule一种/nz简单/a有效/gi的/ude1防范/gi方法/gi。/w首先/d我们/rr要/v知道/vsql注入/gi分析器/n是/vshi如何/ryv工作/gi的/ude1。/w在/p操作过程/l中/f，/w发现/v软件/gi并/cc不是/c冲着/p“/wadmin/nz”/w管理员/gi账号/gi去/vf的/ude1，/w而是/c冲着/p权限/gi（/w如/vflag/nz=/nz1/nz）/w去/vf的/ude1。/w这样一来/dl，/w无论/c你/rr的/ude1管理员/gi账号/gi怎么/ryv变/v都/d无法/v逃过/v检测/gi。/w  /x既然/c无法/v逃过/v检测/gi，/w那/rzv我们/rr就/d做/v两/nz个/q账号/gi，/w一个/mq是/vshi普通/a的/ude1管理员/gi账号/gi，/w一个/mq是/vshi防止/gi注入/gi的/ude1账号/gi，/w为什么/ryv这么/rz说/v呢/y？/w笔者/n想/v，/w如果/c找/v一个/mq权限/gi最大/gm的/ude1账号/gi制造/gi假象/n，/w吸引/v软件/gi的/ude1检测/gi，/w而/cc这个/rz账号/gi里/f的/ude1内容/gi是/vshi大于/v千字/nz以上/f的/ude1中文/gi字符/gi，/w就/d会/v迫使/vi软件/gi对/p这个/rz账号/gi进行/vn分析/gi的/ude1时候/n进入/v全/a负荷/n状态/gi甚至/d资源/gi耗尽/v而/cc死机/gi。/w下面/f我们/rr就/d来/vf修改/gi数据库/gi吧/y。/w⒈/nz对/p表/n结构/gi进行/vn修改/gi。/w将/d管理员/gi的/ude1账号/gi字段/gi的/ude1数据类型/gi进行/vn修改/gi，/w文本/gi型/k改成/v最大/gm字段/gi255/nz（/w其实/d也/d够/v了/ule，/w如果/c还/d想/v做/v得/ude3再/d大点/n，/w可以/v选择/gi备注/n型/k）/w，/w密码/gi的/ude1字段/gi也/d进行/vn相同/a设置/gi。/w⒉/nz对/p表/n进行/vn修改/gi。/w设置/gi管理员/gi权限/gi的/ude1账号/gi放在/vid/nz1/nz，/w并/cc输入/v大量/m中文/gi字符/gi（/w最好/d大于/v100/nz个/q字/n）/w。/w⒊/nz把/pba真正/d的/ude1管理员/gi密码/gi放在/vid/nz2/nz后/f的/ude1任何/rz一个/mq位置/gi（/w如/v放在/vid/nz549/nz上/f）/w。/w  /x在/ptd/nz时代/gi，/w“/w存在/v的/ude1就是/v合理/a的/ude1”/w这个/rz理论/gi不仅仅/d应用于/v好/a的/ude1方面/n，/w对于/psql注入/gi攻击/gi也/d一样/uyy，/w为什么/ryv会/v有/vyou这样/rzv的/ude1弊端/n，/w说明/v我们/rr的/ude1编程/gi还/d不够/a完美/a，/w说明/v有/vyou好/a多/a人/n在/p一次/nz又/d一次/nz的/ude1挑战/gi这个/rz社会/n。/w本身/rz应用程序/nz开发/gi过程/gi中的/v不/d严密/a，/w对于/p大多/d数/n防火墙/gi来说/uls，/w这种/r攻击/gi是/vshi“/w合法/a”/w的/ude1。/w我们/rr要/v做/v的/ude1只有/c不断/d的/ude1完善/v编程/gi~/nz~/nz~/nz~/nz~/nz~/nz  /x