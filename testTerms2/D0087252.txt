#为什么/ryvWAF/nz（/wWeb Aplication Firewalls/nz）/w不能/v确保/v数据库安全/gi？/w
警告/vn：/w不要/d以为/v有/vyou了/ule waf /nz的/ude1保护/gi，/w数据库安全/gi就/d万无一失/vl了/ule。/w事实上/bl，/w数据库/gi仍然/d存在/v很大/d的/ude1安全隐患/nz。/wweb /nz应用程序/nz防火墙/gi（/wwaf/gi）/w现在/t已经/d成为/v许多/m商业/n web /nz网站/gi与/cc系统/gi的/ude1基本/a保护措施/nz，/w它/rr的确/d在/p防范/gi许多针/nz对/p web /nz系统/gi的/ude1安全/gi攻击/gi方面/n卓有成效/vl，/w但是/c waf /nz在/p面对/v攻击方式/n多种多样/bl的/ude1 sql /nz注入/gi方面/n还是/c显得/v束手无策/vl。/w背景/n知识/gi：/w什么/ry是/vshi waf/nz？/wweb /nz应用/gi防火墙/gi（/wwaf/gi）/w是/vshi一种/nz基础/gi的/ude1安全/gi保护/gi模块/gi，/w主要/b针对/gi http /nz访问/gi的/ude1 web /nz程序/gi保护/gi，/w部署/gi在/p web /nz应用程序/nz前面/f，/w在/p用户/gi请求/gi到达/v web /nz服务器/gi前/f对/p用户/gi请求/gi进行/vn扫描/gi和/cc过滤/gi，/w分析/gi并/cc校验/v每个/r用户/gi请求/gi的/ude1网络/gi包/v，/w确保/v每个/r用户/gi请求/gi有效/gi且/c安全/gi，/w对/p无效/vi或有/c攻击/gi行为/n的/ude1请求/gi进行/vn阻断/v或/c隔离/vn。/wwaf /nz可/v通过/p定义/gi一/nz些/q常见/a的/ude1 sql /nz注入/gi特征/gi码/v对/p常见/a sql /nz注入/gi攻击/gi提供/v防护/gi，/w比如/v sql /nz注入/gi代码/gi加入/v到/v某些/rz命令/gi或/c某些/rz输入/v，/w这些/rz waf /nz是/vshi没有/v问题/gi的/ude1。/w但是/c市面上/n的/ude1关系型/b数据/gi总类/nz非常/d多/a，/w虽然/c有/vyou统一/vn的/ude1 sql /nz结构化/n数据/gi查询/gi语言/gi，/w但是/c每个/r数据库/gi的/ude1具体/a实现/gi有/vyou非常/d多/a的/ude1差异/n，/w这些/rz差异/n就/d导致/gi了/ule多/a种/q sql /nz注入/gi攻击方式/n的/ude1产生/v。/w因此/c也/d就/d导致/gi了/ule像/v waf /nz这类/r安全/gi保护/gi系统/gi在/p不/d理解/gi应用程序/nz的/ude1上下文/gi，/w不/d熟悉/v数据库/gi类型/gi、/w命令/gi、/w结构/gi的/ude1情况下/nz，/w仅仅/d通过/p分析/gi网络/gi数据包/gi，/w加上/v定义/gi一/nz些/q数据库/gi特殊字符/gi黑名单/n，/w远远/d不足以/v防护/gi多种多样/bl的/ude1 sql /nz注入/gi攻击/gi。/wwaf /nz在/p web /nz应用/gi安全/gi防护/gi方面/n的/ude1作用/gi的确/d值得/v认可/vn，/w它/rr能/v有效/gi防护/gi多/a种/q web /nz攻击/gi，/w每个/r企业/gi都/d应该/v使用/gi waf /nz为/p web /nz应用程序/nz提供/v安全/gi保障/vn。/w但是/c，/w千万/nz不要/d天真/a地/ude2以为/v，/w有/vyou了/ule waf /nz你/rr的/ude1数据库/gi就/d安全/gi了/ule，/w这种/r想法/gi非常/d的/ude1危险/an。/w数据库/gi暴露/v的/ude1访问/gi点/gi多种多样/bl从/p waf /nz的/ude1原理/gi来看/u，/wwaf /nz并/cc不能/v完全/ad保护/gi web /nz应用程序/nz免受/v sql /nz注入/gi攻击/gi，/w因为/c它/rr在/p web /nz应用程序/nz外部/f，/w不/d了解/v应用程序/nz的/ude1上下文/gi，/w不/d知道/v目标/gi数据库/gi的/ude1类型/gi，/w这/rzv就/d从根本上/nz决定/v了/ule waf /nz只能/v防范/gi最/d常见/a的/ude1 sql /nz注入/gi方式/n。/w即使/c waf /nz做/v的/ude1足够/v好/a，/w能够/v防范/gi绝大/nz多数/a从/p web /nz系统/gi进入/v的/ude1 sql /nz注入/gi攻击/gi，/w也/d不能/v断言/v数据库/gi得到/v了/ule全面/ad的/ude1保护/gi，/w因为/c能/v访问/gi数据库/gi的/ude1不仅仅/d是/vshi web /nz系统/gi，/w还有/v许多其他/nz途径/n。/w除了/p web /nz系统/gi外/f，/w还有/v三类/b主要/b的/ude1数据库/gi访问/gi途径/n：/w组织/gi内/f其他/rzv应用系统/gi能/v访问/gi数据库/gi：/w比如/v在/p电子商务系统/nz里/f，/w价格/n和/cc库存/gi可能会/nz用/p一/nz些/q自动化/gi的/ude1脚/n本来/d定时/d更新/gi。/w一/nz些/q内部/f管理程序/gi可以/v访问/gi系统/gi，/w也/d可能/v是/vshi一/nz些/q接口/gi，/w方便/a雇员/nnt添加/gi信息/gi或者/c发送信息/n给/p客户/n。/w还有/v就是/v数据库/gi dba/nz，/wit /nz经理/gi，/wqa/nz，/w开发人员/n等等/udeng内部人员/n通过/p数据库/gi管理工具/nz可以/v访问/gi数据库/gi。/wwaf /nz只/d监控/gi通过/p http /nz方式/n来/vf的/ude1数据/gi，/w这些/rz潜在/b的/ude1数据库/gi访问/gi源头/n waf /nz是/vshi毫不/d知情/vi的/ude1，/w但是/c来自/v内部/f的/ude1攻击/gi则/d更/d可怕/a。/w内部人员/n非常/d清楚/a数据库/gi的/ude1结构/gi和/cc内容/gi，/w目标性/n也/d更加/d明确/a，/w不是/c获取/gi经济/gi利益/n就是/v获取/gi大量/m内部/f信息/gi，/w造成/v的/ude1危害/gi可以/v说/v是/vshi毁灭性/n的/ude1，/w比如/v前两年/nz发生/v在/p银行/gi客户/n数据库/gi大规模/b泄露/gi事件/gi就/d很/d清晰/a地/ude2证明了/v这一点/nz。/w同时/c现在/t黑客攻击/nz手段/n越来越/d高明/a，/w翻墙/nz技术/gi已经/d非常/d成熟/a，/w而且/c在/p云/gi时代/gi有/vyou明显/a边界/n的/ude1网络拓扑/gi结构/gi越来越少/nz。/w总之/c，/wwaf /nz对/p sql /nz注入/gi攻击/gi的/ude1防护/gi作用/gi越来越/d小/a。/w多维度/ns数据库/gi保护/gi是/vshi万/nz全/a之/uzhi策/ng既然/c数据库/gi的/ude1访问/gi途径/n很/d多/a，/w要/v想/v比较/gi好/a的/ude1解决/v数据/gi泄露/gi的/ude1危险/an，/w多维度/ns防护/gi才/d是/vshi最佳/z方法/gi，/w只有/c堵住/v每条/d可能/v泄露/gi的/ude1攻击/gi才能/n确保/v数据库/gi的/ude1安全/gi，/w可能/v的/ude1方法/gi包括/v但/c不仅/c限于/v：/w运行/gi时/qt应用程序/nz自我/rr保护/gi（/wrasp/nz）/w数据库/gi防火墙/gi模式/gi学习/gi过程/gi职责/gi分离/vi风险/gi为基础/nz的/ude1政策/n敏感/gi信息/gi屏蔽/v定期/d审计/vn管理/gi和/cc访问/gi敏感/gi信息/gi运行/gi时/qt应用程序/nz自我/rr保护/gi（/wrasp/nz）/wrasp /nz针对/gi应用程序/nz保护/gi的/ude1，/w不仅仅/d是/vshi对/p web /nz应用/gi测试/gi，/w它/rr将/d代码/gi扫描/gi工具/gi的/ude1漏洞/n发现/v功能/gi和/cc waf /nz的/ude1实时/n攻击/gi拦截/v能力/gi结合/v起来/vf，/w将/d这些/rz防护/gi功能/gi像/v疫苗/n一样/uyy注入/gi到/v应用程序/nz中/f，/w让/v应用程序/nz像/v人体/gi拥有/v疫苗/n一样/uyy对/p攻击/gi拥有/v免疫能力/n，/w找到/v所有/b已知/nz漏洞/n，/w像/v一个/mq虚拟/gi的/ude1大/a补丁/gi一样/uyy修补/v所有/b已知/nz漏洞/n，/w免于/v大多/d数/n漏洞/n攻击/gi，/w同时/c它/rr和/cc应用程序/nz一起/s运行/gi同一个/b进程/gi，/w拥有/v应用程序/nz的/ude1上下文/gi，/w了解/v应用程序/nz的/ude1每一个/nz动作/gi，/w因此/c能/v精确/gi了解/v每一个/nz攻击/gi并/cc能够/v实时/n对/p攻击/gi进行/vn防御/gi。/w比如/v sql /nz注入/gi，/w它/rr在/p每个/r数据库/gi jdbc /nz的/ude1 statement /nz具体/a实现/gi里/f，/w根据/p每个/r不同/a的/ude1数据/gi，/w有/vyou针对性/n地/ude2将/d sql /nz注入/gi保护/gi程序/gi注入/gi，/w这样/rzv就/d能/v确保/v各种/rz可能/v的/ude1 sql /nz注入/gi攻击/gi得到/v有效/gi的/ude1防范/gi，/w并且/c这个/rz防护/gi是/vshi在/p应用程序/nz访问/gi数据库/gi的/ude1必经之路/nz，/w是/vshi不可/v绕过/v的/ude1。/w这/rzv两/nz个/q优势/gi是/vshi waf /nz无法/v企及/vi的/ude1。/w如果/c每个/r应用程序/nz都/d进行/vn rasp /nz保护/gi，/w至少/d无论/c内外/f通过/p应用/gi进行/vn sql /nz注入/gi基本上/d是/vshi不/d可能/v的/ude1，/w这样/rzv就/d可以/v堵住/v应用程序/nz访问/gi数据库/gi的/ude1漏洞/n。/w目前/t rasp /nz是/vshi比较/gi新的/a概念/gi，/w国外/s有/vyou hp /nz在/p做/v，/w国内/s有一个/nz初创/vi安全/gi  /x在/p做/v类似/a的/ude1产品/gi，/w大家/rr有/vyou有兴趣/v可以/v关注/v一/nz下/f。/w数据库/gi防火墙/gi数据库/gi防火墙/gi技术/gi是/vshi针对/gi关系型数据库/gi保护/gi需求/gi应运而生/vl的/ude1一种/nz数据库安全/gi主动防御/gi技术/gi，/w数据库/gi防火墙/gi部署/gi于/p应用服务器/gi和/cc数据库/gi之间/f。/w用户/gi必须/d通过/p该/rz系统/gi才能/n对/p数据库/gi进行/vn访问/gi或/c管理/gi。/w数据库/gi防火墙/gi所/usuo采用/v的/ude1主动防御/gi技术/gi能够/v主动/ad实时/n监控/gi、/w识别/gi、/w告警/gi、/w阻挡/v绕过/v企业/gi网络/gi边界/n（/wfirewall/nz、/wids/nz\/nzips/nz等/udeng）/w防护/gi的/ude1外部/f数据/gi攻击/gi、/w来自/v于/p内部/f高/a权限/gi用户/gi（/wdba/gi、/w开发人员/n、/w第三方/nz外包/nz服务提供商/nz）/w的/ude1数据/gi窃取/v、/w破坏/v、/w损坏/v等/udeng，/w从/p数据库/gi sql /nz语句/gi精细化/n控制/vn的/ude1技术/gi层面/n，/w提供/v一种/nz主动/ad的/ude1安全/gi防御/gi措施/gi。/w模式匹配/gi学习/gi过程/gi基于/p自/p学习/gi机制/gi的/ude1风险/gi管控/nz模型/gi，/w主动/ad监控/gi数据库/gi活动/gi，/w防止/gi未/d授权/v的/ude1数据库/gi访问/gi、/wsql /nz注入/gi、/w权限/gi或/c角色/gi升级/vi，/w与/cc对/p敏感数据/gi的/ude1非法/b访问/gi等/udeng。/w基于/p风险管理/nz的/ude1策略/gi任何/rz类型/gi的/ude1数据库/gi查询/gi语句/gi或/c命令/gi，/w都/d可以/v用/p一/nz些/q方法/gi来/vf评估/gi。/w影响/gi风险评估/gi的/ude1因素/gi包括/v白名单/nz和/cc黑名单/n，/w命令/gi是从/v哪里/rys过来/vf的/ude1，/w在/p一定/b时间/gi有/vyou多少/ry个/q类似/a的/ude1命令/gi等等/udeng，/w利用/v所有/b的/ude1信息/gi，/w一个/mq基于/p规则/gi的/ude1系统/gi可以/v借助/v一系列/b的/ude1规则/gi来/vf评估/gi哪些/ry命令/gi是/vshi可疑/a的/ude1。/w权责/n分明/a为/p数据库/gi访问/gi分配/gi适当/a的/ude1权限/gi是/vshi非常/d必要/a的/ude1。/w基于/p web /nz的/ude1应用程序/nz只/d应该/v有/vyou有限/a的/ude1查询/gi权限/gi，/w数据库管理员/nnt拥有/v更大/d的/ude1管理权限/n是/vshi有/vyou必要/a的/ude1。/w通过/p适当/a地/ude2执行/v职责/gi分离/vi，/w可以/v有效/gi避免/v多/a种/q数据库/gi攻击/gi。/w混淆/v敏感数据/gi所有人/n都/d应该/v能/v查看/gi敏感数据/gi，/w甚至/d包括/v数据库管理员/nnt，/w程序员/gi，/w以及/cc高/a管/v。/wdba /nz可以/v执行/v一/nz些/q数据库管理/gi任务/gi，/w但是/c没有/v必要/a让/v他们/rr能/v看到/v数据库/gi中/f个人/n的/ude1敏感数据/gi，/w为了/p达到/v这个/rz目的/gi，/w使用/gi一个/mq非常/d强大/a的/ude1和/cc实时/n的/ude1数据/gi混淆/v解决方案/gi是/vshi非常/d重要/a的/ude1。/w一/nz些/q组织/gi使用/gi离线/n的/ude1“/w生产/gi”/w系统/gi进行/vn屏蔽/v，/w但/c随着/p实时/n数据/gi的/ude1混淆/v的/ude1成熟/a，/w实时/n数据/gi混淆/v系统/gi在/p成本/n和/cc避免/v数据/gi更新/gi方面/n有/vyou更大/d的/ude1优势/gi，/w所有/b改变/v都/d可以/v实时/n在/p数据库/gi中/f体现/v。/w定时/d审计/vn对/p敏感数据/gi的/ude1管理/gi和/cc访问/gi行为/n一致/a的/ude1和/cc可靠/a的/ude1审计/vn过程/gi中/f，/w寻找/v可疑/a的/ude1活动/gi和/cc更新/gi政策/n，/w不断/d提高/v数据库安全/gi还有/v很长/d的/ude1路/n要/v走/v。/w今天/t的/ude1数据库安全/gi产品/gi可以/v根据/p可/v定制/n的/ude1规则/gi对/p某些/rz种类/n的/ude1访问/gi提供/v警报/n服务/gi。/w让/v每个/r公司/nis都/d能/v保护/gi得/ude3起/vf数据库安全/gi在/p以前/f，/w数据库安全/gi保护/gi只有/c少数/mq大/a公司/nis花/n大/a价钱/n才能/n搞好/v，/w数据库/gi防火墙/gi非常/d昂贵/a。/w制定/gi规则/gi，/w审计/vn行为/n都/d需要/v大量/m的/ude1人力/gi去/vf解决/v，/w小/a公司/nis基本/a没有/v能力/gi去/vf做/v。/w现在/t  /x是/vshi一种/nz非常/d好/a的/ude1解决方案/gi，/w只要/c制定/gi简单/a规则/gi，/w比如/v只有/c管理员/gi能/v访问/gi生产/gi数据库/gi等/udeng，/w其他/rzv所有/b数据库/gi访问/gi都/d通过/p应用程序/nz进行/vn，/w而/cc每个/r应用程序/nz都/d安装/gi rasp /nz保护/gi程序/gi，/w这样/rzv数据库/gi的/ude1安全/gi才/d是/vshi有/vyou保障/vn的/ude1。/w（/w实时/n应用/gi自我/rr保护/gi）/w是/vshi一种/nz基于/p云/gi的/ude1应用程序/nz自我/rr保护/gi服务/gi，/w /x可以/v为/p软件产品/gi提供/v实时/n保护/gi，/w使/v其/rz免受/v漏洞/n所累/v。/w