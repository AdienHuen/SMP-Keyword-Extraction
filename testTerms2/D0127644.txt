#redis /nz初识/n
redis/gi是/vshi什么/ry？/wredis/gi是/vshi一个/mq以键/n对/p形式/gi存储/gi的/ude1nosql数据库/gi，/w它/rr的/ude1所有/b数据/gi都/d存储/gi在/p内存/gi中/f，/w并且/c可以/v将/d内存/gi中的/v数据/gi持久化/nz到/v磁盘/gi上/f。/w它/rr可以/v用作/v数据库/gi、/w缓存/gi系统/gi和/cc消息/n代理/gi等/udeng。/w它/rr支持/v5/nz种/q数据结构/gistring/gi、/wlist/gi、/whash/gi、/wset/nz、/wsort set/nz。/w并且/c内置/vn了/ule主从复制/gi功能/gi、/wlua/nz脚本/gi、/w事务/gi和/cc不同/a级别/n的/ude1持久化/nz，/w另外/c还/d提供/v了/ule通过/predis sentinel/nz实现/gi的/ude1redis/gi高/a可用/v，/w还有/vredis /nz集群/gi自动/d分区/gi等/udeng实现/gi。/w它/rr是/vshi怎么/ryv工作/gi的/ude1？/wredis/gi服务器/gi可以/v与/cc多/a个/q客户端/gi建立/gi网络连接/nz，/w它/rr处理/vn客户端/gi发送/gi的/ude1命令/gi请求/gi，/w然后/c在/p数据库/gi中/f保存/gi执行命令/n所/usuo产生/v的/ude1数据/gi，/w并/cc通过/p资源/gi管理器/nz维持/v着/uzhe服务器/gi自身/rr的/ude1运行/gi。/w从/p启动/gi到/v接受命令/n，/wredis/gi服务器/gi都/d做/v了/ule些/q什么/ry操作/gi？/wredis/gi服务器/gi从/p启动/gi到/v能够/v接受/gi客户端/gi发送/gi的/ude1命令/gi请求/gi，/w需要/v一/nz些/q列/v的/ude1初始化/v和/cc设置/gi，/w比如/v初始化/v服务器/gi状态/gi、/w加载/gi用户/gi配置/gi、/w创建/gi相应/vi的/ude1数据结构/gi和/cc网络连接/nz等/udeng。/w1/nz）/w初始化/v服务器/gi的/ude1状态/gi结构/gi主要/b设置/gi服务器/gi的/ude1运行/giid/nz、/w默认/v配置文件/gi路径/gi、/w运行/gi架构/gi（/w是否/v集群/gi）/w、/w默认/v端口号/n、/wrdb/gi和/ccaof/gi的/ude1持久化/nz条件/n、/wlru/gi时钟/gi、/w创建/gi命令/gi表/n等/udeng。/w2/nz）/w加载/gi用户/gi配置/gi在/p启动/gi服务器时/n，/w用户/gi可以/v通过/p指定/v配置/gi参数/gi或/c配置文件/gi来/vf改变/v服务器/gi的/ude1默认/v配置/gi。/w3/nz）/w初始化/v服务器/gi的/ude1数据结构/gi如/v创建/gi与/cc客户端/gi相关/vn的/ude1状态/gi链表/gi、/w创建/gi包含/v所有/b数据库/gi的/ude1数组/gi（/w默认/vredis/gi服务器/gi有/vyou16/nz个/q数据库/gi）/w、/w与/cc订阅/v频道/n相关/vn的/ude1数据结构/gi等/udeng，/w在/p启动时/l服务器/gi会/v为/p这些/rz数据结构/gi分配/gi相应/vi的/ude1内存/gi。/w在/p创建/gi好/a这些/rz数据结构/gi外/f，/wredis/gi服务器/gi还/d会/v做/v一/nz些/q重要/a的/ude1设置/gi：/w为/p服务器/gi设置/gi进程/gi信号/gi、/w创建/gi共享/gi对象/gi、/w打开/gi监听/gi端口/gi等等/udeng。/w在/p完成/v以上/f初始化/v后/f，/w服务器/gi还/d需要/v加载/girdb/gi文件/gi或/caof/gi文件/gi，/w并/cc根据/p这些/rz文件/gi的/ude1内容/gi来/vf还原/gi服务器/gi的/ude1数据库/gi状态/gi。/w它/rr是/vshi怎么/ryv执行命令/n的/ude1？/w执行命令/n的/ude1过程/gi如下/vi：/w1/nz）/w：/w客户端/gi向/p服务器端/gi发送/gi命令/gi请求/giset key value/nz。/w2/nz）/w：/w服务器/gi接收/gi并/cc处理/vn客户端/gi发来/v的/ude1命令/gi请求/gi，/w在/p数据库/gi中/f做/v相关/vn设置/gi操作/gi，/w并/cc产生/v命令/gi回复/vok/nz。/w3/nz）/w：/w服务器/gi将/d命令/gi回复/v发送给/n客户端/gi。/w4/nz）/w：/w客户端/gi接收/gi服务器返回/n的/ude1命令/gi恢复/gi，/w并/cc把/pba回复/v内容/gi打印/v给/p用户/gi。/w对于/p步骤/gi1/nz，/w在/p客户端/gi将/d命令/gi请求/gi发送给/n服务器/gi前/f，/w会/v将/d这个/rz命令/gi请求/gi转换成/i协议/gi式/k，/w并/cc通过/p与/cc服务器/gi建立/gisocket/gi连接/gi，/w才/d将/d转换成/i协议/gi后/f的/ude1命令/gi请求/gi发送给/n服务器/gi。/w对于/p步骤/gi2/nz，/w服务器/gi接收/gi到/v命令/gi请求/gi后/f，/w读取/gisocket/gi中的/v命令/gi请求/gi，/w并/cc将/d其/rz保存/gi到/v缓冲区/gi里/f，/w然后/c服务器/gi对/p缓冲区/gi里面/f的/ude1命令/gi请求/gi进行/vn解析/gi，/w提取/v出/vf命令/gi请求/gi中/f包含/v的/ude1命令/gi参数/gi和/cc参数/gi个数/n，/w并/cc保存/gi到/v一个/mq与/cc客户端/gi相关/vn的/ude1数据结构/gi中/f。/w然后/c调用/gi命令/gi执行器/nz，/w执行命令/n。/w但是/c在/p执行命令/n前/f，/w还要/d做/v一/nz些/q相关/vn的/ude1准备/v：/w检查/gi命令/gi是否/v存在/v命令/gi表/n中/f，/w以及/cc检查/gi命令/gi的/ude1参数/gi和/cc参数/gi个数/n是否/v匹配/gi，/w另外/c还有/v身份验证/nz、/w内存/gi的/ude1使用/gi情况/n、/w客户端/gi使用/gi的/ude1是否/v为/p订阅/v模式/gi、/w客户端/gi是否/v使用/gi了/ule事务/gi、/w是否/v启动/gi了/ule监视器/n等等/udeng。/w只有/c在/p这些/rz检查/gi都/d通过/p了/ule，/w才能/n调用/gi命令/gi的/ude1实现/gi函数/gi，/w真正/d开始/v处理/vn命令/gi请求/gi，/w命令/gi实现/gi函数/gi负责/v执行命令/n指定/v的/ude1操作/gi，/w并/cc产生/v相应/vi的/ude1命令/gi回复/v，/w这些/rz回复/v会/v被/pbei保存/gi到/v与/cc客户端/gi相关联/l的/ude1缓冲区/gi里/f，/w然/rz会/v实现/gi函数/gi还/d会/v为/p客户端/gi的/ude1套接字/n关联/vn命令/gi回复/v处理器/gi，/w这个/rz处理器/gi负责/v把/pba命令/gi回复/v发送给/n客户端/gi。/w执行/v完/vi实现/gi函数/gi后/f，/w还/d需/v做/v一/nz些/q后续/vn工作/gi：/wa/nz）/w检查/gi是否/v开启/gi了/ule慢查询/gi日志/gi功能/gi，/w如果/c是/vshi，/w将/d会/v为/p该/rz命令/gi添加/gi一条/nz新的/a慢查询/gi日志/gi。/wb/nz）/w检查/gi是否/v开启/gi了/uleaof/gi持久化/nz功能/gi，/w如果/c是/vshi，/w将/d会/v把/pba该/rz命令/gi添加/gi到/vaof/gi的/ude1缓冲区/gi里面/f。/wc/nz）/w检查/gi是否/v其它/rz的/ude1从/p服务器/gi正在/d复制/gi该/rz服务器/gi，/w如果/c有/vyou，/w就/d会/v把/pba该/rz命令/gi发送给/n所有/b的/ude1从/p服务器/gi。/w至此/d，/w服务器/gi对/p该/rz命令/gi执行/v完毕/vi，/w就/d可以/v继续/v从/p缓冲区/gi里/f取出/v下/f一条/nz命令/gi来/vf处理/vn执行/v了/ule。/w对于/p步骤/gi3/nz：/w前面/f提到/v的/ude1，/w由/p命令/gi实现/gi函数/gi为/p客户端/gi的/ude1socket/gi关联/vn命令/gi回复/v处理器/gi，/w当/p客户端/gi的/ude1socket/gi变得/vi可写/v时/qt，/w命令/gi回复/v处理器/gi将/d会/v把/pba保存/gi在/p与/cc客户端/gi相关联/l的/ude1缓冲区/gi里/f的/ude1命令/gi回复/v发送/gi个/q客户端/gi。/w当/p发送/gi完毕/vi后/f，/w命令/gi回复/v处理/vn会/v清空/nz与/cc客户端/gi关联/vn的/ude1缓冲区/gi，/w为/p处理/vn下一个/nz命令/gi请求/gi做/v准备/v。/w对于/p步骤/gi4/nz，/w当/p客户端/gi接收/gi到/v命令/gi回复/v后/f，/w会/v将/d这些/rz回复/v转换/gi为/p可读/v的/ude1式/k，/w打印/v给/p用户/gi看/v。/w那么/c它/rr是/vshi怎么/ryv维持/v自身/rr的/ude1运行/gi的/ude1呢/y？/wredis/gi服务器/gi默认/v每隔/d100/nzms/nz调用/gi一次/nzservercron/nz函数/gi，/w这个/rz函数/gi负责管理/n服务器/gi的/ude1资源/gi，/w来/vf维持/v服务器/gi自身/rr的/ude1运转/vi。/w负责管理/n的/ude1资源/gi都/d有/vyou：/w管理/gi服务器/gi的/ude1内存/gi使用/gi情况/n、/w管理/gi客户端/gi的/ude1资源/gi（/w连接/gi状态/gi）/w、/w管理/gi数据库/gi的/ude1资源/gi（/w删除/gi过期/gi的/ude1键/n、/w对/p数据压缩/nz等/udeng）/w、/w检查/giaof/gi运行/gi状态/gi以及/cc将/daof/gi缓冲区/gi里/f的/ude1数据/gi写到/vaof/gi文件/gi中等/b。/w和/cc其它/rz类型/gi的/ude1数据库/gi区别/gi？/w和/cc关系型数据库/gi的/ude1区别/gi对于/p关系型数据库/gi（/woracle/gi、/wmysql/gi）/w通常/d需要/v写/vsql/gi脚/n本来/d查询/gi多/a个/q表/n之间/f关联/vn的/ude1数据/gi，/w数据/gi是/vshi完全/ad结构化/n存储/gi的/ude1，/w并且/c是/vshi存储/gi在/p磁盘/gi上/f的/ude1，/w另外/c还/d支持/v事务/gi、/w索引/gi等/udeng，/w但/c在/predis/gi中/f并/cc没有/v这些/rz概念/gi，/w它/rr的/ude1数据/gi是/vshi以键/n对/p的/ude1形式/gi存储/gi的/ude1，/w不/d支持/v关联/vn查询/gi，/w数据/gi是非/n结构化/n的/ude1，/w并且/c数据/gi是/vshi完全/ad存储/gi在/p内存/gi中的/v，/w它/rr也/d支持/v事务/gi，/w但/c事务/gi的/ude1级别/n比较/gi低/a，/w不能/v创建/gi索引/gi。/w但是/credis/gi查询/gi速度/n是/vshi关系型数据库/gi没法/v比/p的/ude1，/w因为/c它/rr的/ude1数据/gi总是/d在/p内存/gi中/f，/w不/d需要/v对/p查询/gi语句/gi的/ude1解析/gi和/cc优化/gi，/w并且/credis/gi查询/gi数据/gi不会/v产生/v不必要/a的/ude1临时/gi数据/gi，/w这样/rzv就/d避免/v了/ule扫描/gi过后/v还/d得/ude3要/v再/d删除/gi这些/rz临时/gi数据/gi，/w最终/d提高/v了/ule查询/gi性能/gi。/w和/ccmemcached/gi的/ude1区别/gimemcached/gi和/ccredis/gi很/d相/d，/w数据/gi都/d是/vshi存储/gi在/p内存/gi中/f，/w同样/d也/d是/vshi以键/n对/p的/ude1形式/gi存储/gi数据/gi的/ude1，/w但/c它/rr只有/c一种/nz数据存储/gi结构/gi（/w只能/v以/p字符串/gi的/ude1形式/gi存储/gi数据/gi）/w，/w而/ccredis/gi除了/p这/rzv一种/nz还有/vlist/gi、/whash/gi、/wset/nz、/wsortset/nz四种/nz，/w最大/gm的/ude1不同/a是/vshiredis/gi可以/v把/pba数据/gi持久化/nz到/v磁盘/gi上/f，/w并/cc支持/v数据/gi的/ude1主从复制/gi。/w相对/dmemcached/gi，/wredis/gi能够/v解决/v更/d广泛/a的/ude1问题/gi。/w为什么/ryv要用/v它/rr？/wredis/gi作为/p内存数据库/gi，/w查询/gi速度快/nz、/w并发/gi量/n高/a，/w但/c缺点/gi是/vshi数据类型/gi少/a、/w关联/vn查询/gi不方便/nz、/w不能/v存储/gi海量/gi的/ude1数据/gi，/w一般/ad用作/v缓存/gi系统/gi、/w消息/n代理/gi等/udeng，/w通常/d作为/p辅助/vn数据库/gi和/cc其他/rzv的/ude1存储系统/gi配合/v使用/gi，/w到底/d要/v不要/d选择/gi用/predis/gi，/w根据/p自己/rr应用/gi的/ude1需求/gi、/w应用场景/gi来/vf抉择/vn。/w