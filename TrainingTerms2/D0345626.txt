#网络虚拟化/gi技术/gi（/w一/nz）/w:/w Linux/nz网络虚拟化/gi
转载/v：/w笔者/n现在/t在/p做/v云计算/gi的/ude1网络/gi设计/gi，/w涉及/v到/v上/f百台/nz服务器/gi与/cc交换机/gi，/w在/p实测/vn前/f必须/d进行/vn原型/gi测试/gi，/w但是/c我/rr只有/c一个/mq工作/gi用/p开发机/nz，/w本文/r介绍/gi一种/nz方法/gi，/w使用/gi这/rzv一/nz台/q机器/gi模拟/gi数/n十台/nz服务器/gi以及/cc路由器/gi的/ude1网络/gi环境/n。/wlinux/gi的/ude1网络虚拟化/gi是/vshilxc/nz项目/gi中的/v一个子/nz项目/gi，/wlxc/nz包括/v文件系统/gi虚拟化/gi，/w进程/gi空间/n虚拟化/gi，/w用户/gi虚拟化/gi，/w网络虚拟化/gi，/w等等/udeng /x[/nz]/nz，/w这里/rzs使用/gilxc/nz的/ude1网络虚拟化/gi来/vf模拟/gi多/a个/q网络/gi环境/n。/w创建/gi虚拟/gi网络/gi环境/n使用/gi命令/gi可以/v创建/gi一个/mq完全/ad隔离/vn的/ude1新/a网络/gi环境/n，/w这个/rz环境/n包括/v一个/mq独立/a的/ude1网卡/gi空间/n，/w路由表/nz，/warp/gi表/n，/wip/gi地址/gi表/n，/wiptables/nz，/webtables/nz，/w等等/udeng。/w总之/c，/w与/cc网络/gi有关/vn的/ude1组件/gi都/d是/vshi独立/a的/ude1。/wip/gi命令/gi需要/vroot/gi权限/gi的/ude1，/w但是/c由于/p本文/r大量/m使用/giip/gi命令/gi，/w于是/cc笔者/n给/pip/gi命令/gi添加/gi了/ulecapability/nz，/w使/v普通用户/nz也/d能/v使用/giip/gi命令/gi使用/gi命令/gi可以/v看到/v我们/rr刚才/t创建/gi的/ude1网络/gi环境/n进入/v虚拟/gi网络/gi环境/n使用/gi命令/gi我们/rr可以/v在/p net/nz0/nz /x虚拟环境/gi中/f运行/gi任何/rz命令/gi这样/rzv我们/rr可以/v在/p新的/a网络/gi环境/n中/f打开/gi一个/mqshell/gi，/w可以/v看到/v，/w新的/a网络/gi环境/n里面/f只有/c一个/mqlo/nz设备/gi，/w并且/c这个/rzlo/nz设备/gi与/cc外面/f的/ude1lo/nz设备/gi是/vshi不同/a的/ude1，/w之间/f不能/v互相/d通讯/gi。/w连接/gi两/nz个/q网络/gi环境/n新的/a网络/gi环境/n里面/f没有/v任何/rz网络设备/gi，/w并且/c也/d无法/v和/cc外部/f通讯/gi，/w就是/v一个/mq孤岛/n，/w通过/p下面/f介绍/gi的/ude1这个/rz方法/gi可以/v把/pba两/nz个/q网络/gi环境/n连/ulian起来/vf，/w简单/a的/ude1说/v，/w就是/v在/p两/nz个/q网络/gi环境/n之间/f拉/v一根/nz网线/n先/d创建/gi另一个/nz网络/gi环境/nnet/nz1/nz，/w我们/rr的/ude1目标/gi是/vshi把/pbanet/nz0/nz与/ccnet/nz1/nz连/ulian起来/vf这里/rzs创建/gi连/ulian一/nz对/pveth/nz虚拟/gi网卡/gi，/w类/gipipe/nz，/w发给/vveth/nz0/nz的/ude1数据包/giveth/nz1/nz那边/rzs会/v收到/v，/w发给/vveth/nz1/nz的/ude1数据包/giveth/nz0/nz会/v收到/v。/w就/d相当于/v给/p机器/gi安装/gi了/ule两/nz个/q网卡/gi，/w并且/c之间/f用/p网线/n连接起来/l了/ule这/rzv两/nz条/q命令/gi的/ude1意思/n就是/v把/pbaveth/nz0/nz移动/vn到/vnet/nz0/nz环境/n里面/f，/w把/pbaveth/nz1/nz移动/vn到/vnet/nz1/nz环境/n里面/f，/w我们/rr看看/v结果/nveth/nz0/nz veth/nz1/nz已经/d在/p我们/rr的/ude1环境/n里面/f消失/vi了/ule，/w并且/c分别/d出现/v在/pnet/nz0/nz与/ccnet/nz1/nz里面/f。/w下面/f我们/rr简单/a测试/gi一下/mnet/nz0/nz与/ccnet/nz1/nz的/ude1联通/v性/ng分别/d配置/gi好/a两/nz个/q设备/gi，/w然后/c用/pping/gi测试/gi一下/m联通/v性/ng：/w一个/mq稍微/d复杂/a的/ude1网络/gi环境/n创建/gi虚拟/gi网络/gi环境/n并且/c连接/gi网线/n在/pbridge/gi中/f创建/gi并且/c设置/gibr/nz设备/gi然后/c配置/gi两/nz个/q虚拟环境/gi的/ude1网卡/gi测试/gi配置/gilldpd/nz检查/gi线路/n链接/gi情况/n随着/p虚拟/gi网络/gi环境/n增加/v，/w环境/n中/f网卡/gi数量/n也/d在/p不断/d增加/v，/w经常/d会/v忘记/v环境/n中/f哪些/ry网卡/gi连接/gi到/v哪里/rys，/w通过/p lldp /nz[/nz]/nz /x协议/gi，/w我们/rr可以/v清楚/a看到/v每个/r网卡/gi连接/gi到/v了/ule哪些/ry环境/n中的/v哪个/ry网卡/gi。/wgithub /nz上有/v一个/mq lldp /nz在/p linux /nz下/f的/ude1开源/gi实现/gi /x[/nz]/nz，/w通过/p在/p每个/r环境/n中/f起/vf一个/mq lldp daemon/nz，/w我们/rr就/d可以/v实时/n查看/gi每个/r网卡/gi的/ude1连接/gi情况/nbridge /nz上/f lldp /nz的/ude1数据/gi