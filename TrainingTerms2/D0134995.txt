#大数据/gi存取/gi的/ude1选择/gi：/w行存储/gi还是/c列存储/gi？/w
目前/t大数据存储/gi有/vyou两/nz种/q方案/gi可供/v选择/gi：/w行存储/gi和/cc列存储/gi。/w业界/n对/p两/nz种/q存储/gi方案/gi有/vyou很/d多/a争持/v，/w集中/v焦点/n是/vshi:/w谁/ry能够/v更/d有效地/nz处理/vn海量数据/gi，/w且/c兼顾/v安全/gi、/w可靠/a、/w完整性/gi。/w从/p目前/t发展/gi情况/n看/v，/w关系数据库/gi已经/d不/d适应/v这种/r巨大/a的/ude1存储量/nz和/cc计算/gi要求/n，/w基本/a是/vshi淘汰/v出局/vi。/w在/p已知/nz的/ude1几/d种/q大数据处理/gi软件/gi中/f，/whadoop/gi的/ude1hbase/gi采用/v列存储/gi，/wmongodb/gi是/vshi文档/gi型/k的/ude1行存储/gi，/wlexst/nz是/vshi二进制/gi型/k的/ude1行存储/gi。/w在/p这里/rzs，/w我/rr不/d讨论/gi这些/rz软件/gi的/ude1技术/gi和/cc优缺点/gi，/w只/d围绕/v机械/n磁盘/gi的/ude1物理/n特质/n，/w分析/gi行存储/gi和/cc列存储/gi的/ude1存储/gi特点/n，/w以及/cc由此/d产生/v的/ude1一些/m问题/gi和/cc解决办法/n。/w一/nz．/w结构/gi布局/gi行存储/gi数据/gi排列/gi列存储/gi数据/gi排列表/nz的/ude1灰色/n背景/n部分/n表示/v行列/n结构/gi，/w白色/n背景/n部分/n表示/v数据/gi的/ude1物理/n分布/vi，/w两/nz种/q存储/gi的/ude1数据/gi都/d是从/v上至/v下/f，/w从/p左向右/nz的/ude1排列/gi。/w行/ng是/vshi列/v的/ude1组合/gi，/w行存储/gi以/p一行/n记录/gi为/p单位/n，/w列存储/gi以/p列/v数据/gi集合/gi单位/n，/w或/c称/v列族/nz（/wcolumn family/nz）/w。/w行存储/gi的/ude1读写/gi过程/gi是/vshi一致/a的/ude1，/w都/d是从/v第一列/nz开始/v，/w到/v最后/f一列/nz结束/v。/w列存储/gi的/ude1读取/gi是/vshi列/v数据/gi集中/v的/ude1一段/nz或者/c全部/m数据/gi，/w写入/gi时/qt，/w一行/n记录/gi被/pbei拆分/gi为/p多列/nz，/w每/rz一列/nz数据/gi追加/v到/v对应/vi列/v的/ude1末尾/n处/n。/w二/nz、/w对比/gi从/p上面/f表/n可以/v看出/v，/w行存储/gi的/ude1写入/gi是/vshi一次/nz完成/v。/w如果/c这种/r写入/gi建立/gi在/p操作系统/gi的/ude1文件系统/gi上/f，/w可以/v保证/v写入/gi过程/gi的/ude1成功/a或者/c失败/vi，/w数据/gi的/ude1完整性/gi因此/c可以/v确定/v。/w列存储/gi由于/p需要/v把/pba一行/n记录/gi拆分/gi成/v单列/v保存/gi，/w写入/gi次数/gi明显/a比行/nz存储/gi多/a，/w再/d加上/v磁头/gi需要/v在/p盘片/n上/f移动/vn和/cc定位/gi花费/v的/ude1时间/gi，/w实际/n时间/gi消耗/gi会/v更大/d。/w所以/c，/w行存储/gi在/p写入/gi上/f占有/v很大/d的/ude1优势/gi。/w还有/v数据/gi修改/gi,/nz这/rzv实际/n也/d是/vshi一次/nz写入/gi过程/gi。/w不同/a的/ude1是/vshi，/w数据/gi修改/gi是/vshi对/p磁盘/gi上/f的/ude1记录/gi做/v删除/gi标记/gi。/w行存储/gi是/vshi在/p指定/v位置/gi写入/gi一次/nz，/w列存储/gi是/vshi将/d磁盘/gi定位/gi到/v多/a个/q列上/v分别/d写入/gi，/w这个/rz过程/gi仍/d是/vshi行存储/gi的/ude1列数/nz倍/q。/w所以/c，/w数据/gi修改/gi也/d是/vshi以/p行存储/gi占优/v。/w /x数据读取/gi时/qt，/w行存储/gi通常/d将/d一行/n数据/gi完全/ad读出/v，/w如果/c只/d需要/v其中/rz几列/nz数据/gi的/ude1情况/n，/w就/d会/v存在/v冗余/n列/v，/w出于/v缩短/v处理/vn时间/gi的/ude1考量/vi，/w消除/v冗余/n列/v的/ude1过程/gi通常/d是/vshi在/p内存/gi中/f进行/vn的/ude1。/w列存储/gi每次/r读取/gi的/ude1数据/gi是/vshi集合/gi的/ude1一段/nz或者/c全部/m，/w如果/c读取/gi多列/nz时/qt，/w就/d需要/v移动/vn磁头/gi，/w再次/d定位/gi到/v下一列/nz的/ude1位置/gi继续/v读取/gi。/w /x再/d谈/v两/nz种/q存储/gi的/ude1数据分布/n。/w由于/p列存储/gi的/ude1每一列/nz数据类型/gi是/vshi同质/n的/ude1，/w不存在/ns二义/n性/ng问题/gi。/w比如说/vl某/rz列/v数据类型/gi为/p整型/nz（/wint/nz）/w，/w那么/c它/rr的/ude1数据/gi集合/gi一定/b是/vshi整型/nz数据/gi。/w这种/r情况/n使/v数据/gi解析/gi变得/vi十分/d容易/ad。/w相比之下/vl，/w行存储/gi则/d要/v复杂/a得/ude3多/a，/w因为/c在/p一行/n记录/gi中/f保存/gi了/ule多种类型/n的/ude1数据/gi，/w数据/gi解析/gi需要/v在/p多/a种/q数据类型/gi之间/f频繁/a转换/gi，/w这个/rz操作/gi很/d消耗/gicpu/gi，/w增加/v了/ule解析/gi的/ude1时间/gi。/w所以/c，/w列存储/gi的/ude1解析/gi过程/gi更/d有利于/v分析/gi大/a数据。三/nz、/w优化/gi显而易见/bl，/w两/nz种/q存储/gi式/k都/d有/vyou各自/rr的/ude1优缺点/gi：/w行存储/gi的/ude1写入/gi是/vshi一次性/d完成/v，/w消耗/gi的/ude1时间/gi比/p列存储/gi少/a，/w并且/c能够/v保证数据/n的/ude1完整性/gi，/w缺点/gi是/vshi数据读取/gi过程/gi中会/j产生/v冗余/n数据/gi，/w如果/c只有/c少量/mq数据/gi，/w此/rzs影响/gi可以/v忽略/v；/w数量/n大/a可能会/nz影响/gi到/v数据/gi的/ude1处理/vn效率/gi。/w列存储/gi在/p写入/gi效率/gi、/w保证数据/n完整性/gi上都/ns不如/v行存储/gi，/w它/rr的/ude1优势/gi是/vshi在/p读取/gi过程/gi，/w不会/v产生/v冗余/n数据/gi，/w这/rzv对/p数据完整性/gi要求/n不/d高/a的/ude1大数据处理/gi领域/gi，/w比如/v互联网/gi，/w犹/d为/p重要/a。/w改进/gi集中/v在/p两/nz方面/n：/w行存储/gi读取/gi过程/gi中/f避免/v产生/v冗余/n数据/gi，/w列存储/gi提高/v读写/gi效率/gi。/w如何/ryv改进/gi它们/rr的/ude1缺点/gi，/w并/cc保证/v优点/gi呢/y？/w行存储/gi的/ude1改进/gi：/w减少/v冗余/n数据/gi首先/d是/vshi用户/gi在/p定义数据/n时/qt避免/v冗余/n列/v的/ude1产生/v；/w其次/c是/vshi优化/gi数据存储/gi记录/gi结构/gi，/w保证/v从/p磁盘/gi读出/v的/ude1数据/gi进入/v内存/gi后/f，/w能够/v被/pbei快速/d分解/gi，/w消除/v冗余/n列/v。/w要/v知道/v，/w目前/t市场/gi上/f即使/c最低/a端/vcpu/gi和/cc内存/gi的/ude1速度/n也/d比/p机械/n磁盘/gi快上/d100/nz-/nz1000/nz倍/q。/w如果/c用上/v高端/nz的/ude1硬件/gi配置/gi，/w这个/rz处理过程/l还要/d更快/d。/w列存储/gi的/ude1两/nz点/gi改进/gi：/w1./nz在/p计算机/gi上/f安装/gi多/a块/q硬盘/gi，/w以/p多线程/gi并行/vn的/ude1方式/n读写/gi它们/rr。/w多/a块/q硬盘/gi并行/vn工作/gi可以/v减少/v磁盘/gi读写/gi竞用/vn，/w这种/r方式/n对/p提高/v处理/vn效率/gi优势/gi十分/d明显/a。/w缺点/gi是/vshi需要/v更多/ad的/ude1硬盘/gi，/w这/rzv会/v增加/v投入/v成本/n，/w在/p大规模/b数据处理/gi应用/gi中/f是/vshi不小/a的/ude1数目/gi，/w运营商/gi需要/v认真/ad考虑/v这个/rz问题/gi。/w2./nz对/p写/v过程/gi中的/v数据完整性/gi问题/gi，/w可/v考虑/v在/p写入/gi过程/gi中/f加入/v类/gi关系数据库/gi的/ude1“回/nz滚”/nz机制/gi，/w当/p某/rz一列/nz发生/v写入/gi失败/vi时/qt，/w此前/t写入/gi的/ude1数据/gi全部/m失效/vi，/w同时/c加入/v散列/nz码/v校验/v，/w进一步/d保证数据/n完整性/gi。/w这/rzv两/nz种/q存储/gi方案/gi还有/v一个/mq共同/d改进/gi的/ude1地方/n：/w频繁/a的/ude1小/a量/n的/ude1数据/gi写入/gi对/p磁盘/gi影响/gi很大/d，/w更好/d的/ude1解决办法/n是/vshi将/d数据/gi在/p内存/gi中/f暂时/d保存/gi并/cc整理/gi，/w达到/v一定/b数量/n后/f，/w一次性/d写入/gi磁盘/gi，/w这样/rzv消耗/gi时间/gi更少/d一/nz些/q。/w目前/t机械/n磁盘/gi的/ude1写入/gi速度/n在/p20/nzm/nz-/nz50/nzm/nz//nz秒/qt之间/f，/w能够/v以/p批量/d的/ude1方式/n写入/gi磁盘/gi，/w效果/gi也/d是/vshi不错/a的/ude1。/w四/nz、/w总结/gi两/nz种/q存储/gi式/k各自/rr的/ude1特性/gi都/d决定/v了/ule它们/rr不/d可能/v是/vshi完美/a的/ude1解决方案/gi。/w /x如果/c首要/b考虑/v是/vshi数据/gi的/ude1完整性/gi和/cc可靠性/gi，/w那么/c行存储/gi是/vshi不二/nz选择/gi，/w列存储/gi只有/c在/p增加/v磁盘/gi并/cc改进/gi软件设计/nz后/f才能/n接近/v这样/rzv的/ude1目标/gi。/w如果/c以/p保存/gi数据/gi为主/vi，/w行存储/gi的/ude1写入/gi性能比/n列存储/gi高/a很/d多/a。/w在/p需要/v频繁/a读取/gi单列/v集合/gi数据/gi的/ude1应用/gi中/f，/w列存储/gi是/vshi最合适/a的/ude1。/w如果/c每次/r读取/gi多列/nz，/w两/nz个/q方案/gi可/v酌情/d选择/gi：/w采用/v行存储/gi时/qt，/w设计/gi中/f应/v考虑/v减少/v或/c避免/v冗余/n列/v；/w若/c采用/v列存储/gi方案/gi，/w为/p保证/v读/v写入/gi效率/gi，/w每/rz列/v数据/gi尽可能/d分别/d保存/gi到/v不同/a的/ude1磁盘/gi上/f，/w多/a个/q线程/gi并行/vn读写/gi各自/rr的/ude1数据/gi，/w这样/rzv避免/v了/ule磁盘/gi竞用/vn的/ude1同时/c也/d提高/v了/ule处理/vn效率/gi。/w /x无论/c选择/gi哪种/ry方案/gi，/w将/d同/p内容/gi数据/gi聚凑/nz在/p一起/s都/d是/vshi必须/d的/ude1，/w这/rzv是/vshi减少/v磁头/gi在/p磁盘/gi上/f的/ude1移动/vn，/w提高/v数据读取/gi时间/gi的/ude1有效/gi办法/gi。/w