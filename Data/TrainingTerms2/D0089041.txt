#大型/b分布式/gi网站架构/gi技术/gi总结/gi
　　/nz本文/r是/vshi学习/gi大型/b分布式/gi网站架构/gi的/ude1技术/gi总结/gi。/w对/p架构/gi一个/mq高性能/gi，/w高/a可用/v，/w可/v伸缩/vn，/w可扩展/nz的/ude1分布式/gi网站/gi进行/vn了/ule概要性/nz描述/gi，/w并/cc给出/v一个/mq架构/gi参考/gi。/w一/nz部分/n为/p读书笔记/nz，/w一/nz部分/n是/vshi个人/n经验总结/nz。/w对/p大型/b分布式/gi网站架构/gi有/vyou很好/ad的/ude1参考价/n。/w（/w如果/c感觉/gi对/p大家/rr有/vyou帮助/v，/w请/v帮忙/vi点/gi推荐/gi，/w谢谢/v。/w本/rz博客/gi会/v逐步/d推出/v一系列/b的/ude1关于/p大型/b分布式/gi网站架构/gi，/w设计模式/nz，/w架构模式/gi方面/n的/ude1系列/n文章/gi，/w交流/gi群/ng：/w466097527/nz）/w　　/nz本次/r分享/gi大纲/n如下/vi大型网站/gi的/ude1特点/n大型网站/gi架构/gi目标/gi大型网站/gi架构模式/gi高性能/gi架构/gi高/a可用/v架构/gi可/v伸缩/vn架构/gi可扩展/nz架构/gi安全/gi架构/gi敏捷/gi架构/gi大型/b架构/gi举例一/nz、/w大型网站/gi的/ude1特点/n用户/gi多/a，/w分布/vi广泛/a大/a流量/gi，/w高并发/gi海量数据/gi，/w服务/gi高/a可用/v安全/gi环境恶劣/n，/w易受/nz网络攻击/gi功能/gi多/a，/w变更/gi快/a，/w频繁/a发布/gi从小到大/nz，/w渐进/v发展/gi以/p用户/gi为/p中心/gi免费/vd服务/gi，/w付费/v体验二/nz、/w大型网站/gi架构/gi目标/gi高性能/gi：/w提供/v快速/d的/ude1访问/gi体验/v。/w高/a可用/v：/w网站/gi服务/gi一直/d可以/v正常/a访问/gi。/w可/v伸缩/vn：/w通过/p硬件/gi增加/v//nz减少/v，/w提高/v//nz降低/v处理/vn能力/gi。/w安全性/gi：/w提供/v网站安全/gi访问/gi和/cc数据加密/gi，/w安全/gi存储/gi等/udeng策略/gi。/w扩展性/n：/w方便/a的/ude1通过/p新增/v//nz移除/v方式/n，/w增加/v//nz减少/v新的/a功能/gi//nz模块/gi。/w敏捷性/nz：/w随需应变/l，/w快速/d响应/v；/w三/nz、/w大型网站/gi架构模式/gi分层/v：/w一般/ad可/v分为/v，/w应用层/gi，/w服务/gi层/gi，/w数据层/nz，/w管理层/n，/w分析/gi层/gi；/w分割/gi：/w一般/ad按照/p业务/gi//nz模块/gi//nz功能/gi特点/n进行/vn划分/v，/w比如/v应用/gi层/gi分为/v首页/gi，/w用户/gi中心/gi。/w分布式/gi：/w将/d应用/gi分开/vi部署/gi（/w比如/v多/a台/q物理机/nz）/w，/w通过/p远程/gi调用/gi协同工作/n。/w集群/gi：/w一个/mq应用/gi//nz模块/gi//nz功能/gi部署/gi多/a份/q（/w如/v：/w多/a台/q物理机/nz）/w，/w通过/p负载均衡/gi共同/d提供/v对外/vn访问/gi。/w缓存/gi：/w将/d数据/gi放在/v距离/gi应用/gi或/c用户/gi最近/t的/ude1位置/gi，/w加快/v访问速度/n。/w异步/gi：/w将/d同步/gi的/ude1操作/gi异步化/nz。/w客户端/gi发出请求/n，/w不/d等待/gi服务端/nz响应/v，/w等/udeng服务端/nz处理完毕/i后/f，/w使用/gi通知/gi或/c轮询/nz的/ude1方式/n告知/v请求/gi方/q。/w一般/ad指/v：/w请求/gi―/w―/w响应/v―/w―/w通知/gi /x模式/gi。/w冗余/n：/w增加/v副本/n，/w提高/v可用性/gi，/w安全性/gi，/w性能/gi。/w安全/gi：/w对/p已知/nz问题/gi有/vyou有效/gi的/ude1解决方案/gi，/w对/p未知/v//nz潜在/b问题/gi建立/gi发现/v和/cc防御机制/nz。/w自动化/gi：/w将/d重复/gi的/ude1，/w不/d需要/v人工/b参与/gi的/ude1事情/n，/w通过/p工具/gi的/ude1方式/n，/w使用/gi机器/gi完成/v。/w敏捷性/nz：/w积极/ad接受/gi需求/gi变更/gi，/w快速/d响应/v业务/gi发展/gi需求/gi。/w四/nz、/w高性能/gi架构/gi以/p用户/gi为/p中心/gi，/w提供/v快速/d的/ude1网页/gi访问/gi体验/v。/w主要参数/nz有/vyou较短/d的/ude1响应/v时间/gi，/w较大/d的/ude1并发/gi处理/vn能力/gi，/w较高/ad的/ude1吞吐量/gi，/w稳定/an的/ude1性能参数/nz。/w可/v分为/v前端/gi优化/gi，/w应用层/gi优化/gi，/w代码/gi层/gi优化/gi，/w存储层/nz优化/gi。/w前端/gi优化/gi：/w网站/gi业务逻辑/gi之前/f的/ude1部分/n；/w浏览器/gi优化/gi：/w减少/vhttp/gi请求/gi数/n，/w使用/gi浏览器/gi缓存/gi，/w启用/gi压缩/gi，/wcss js/nz位置/gi，/wjs/gi异步/gi，/w减少/vcookie/gi传输/gi；/wcdn/gi加速/gi，/w反向代理/gi；/w应用层/gi优化/gi：/w处理/vn网站/gi业务/gi的/ude1服务器/gi。/w使用/gi缓存/gi，/w异步/gi，/w集群/gi代码优化/gi：/w合理/a的/ude1架构/gi，/w多线程/gi，/w资源/gi复用/gi（/w对象/gi池/ng，/w线程池/gi等/udeng）/w，/w良好/a的/ude1数据结构/gi，/wjvm/nz调优/gi，/w单例/gi，/wcache/gi等/udeng；/w存储/gi优化/gi：/w缓存/gi，/w固态/n硬盘/gi，/w光纤/n传输/gi，/w优化/gi读写/gi，/w磁盘/gi冗余/n，/w分布式存储/gi（/whdfs/gi）/w，/wnosql/gi等/udeng；/w五/nz、/w高/a可用/v架构/gi大型网站/gi应该/v在/p任何/rz时候/n都/d可以/v正常/a访问/gi。/w正常/a提供/v对外/vn服务/gi。/w因为/c大型网站/gi的/ude1复杂性/gi，/w分布式/gi，/w廉价/a服务器/gi，/w开源数据库/gi，/w操作系统/gi等/udeng特点/n。/w要/v保证/v高/a可用/v是/vshi很/d困难/an的/ude1，/w也/d就是说/c网站/gi的/ude1故障/gi是/vshi不可避免/vl的/ude1。/w如何/ryv提高/v可用性/gi，/w就是/v需要/v迫切/gi解决/v的/ude1问题/gi。/w首先/d，/w需要/v从/p架构/gi级别/n，/w在/p规划/gi的/ude1时候/n，/w就/d考虑/v可用性/gi。/w行业/gi内/f一般/ad用/p几个/nz9/nz表示/v可用性/gi指标/gi。/w比如/v四个/nz9/nz（/w99.99/nz）/w，/w一年/nz内/f允许/v的/ude1不/d可用/v时间/gi是/vshi53/nz分钟/qt。/w不同/a层级/n使用/gi的/ude1策略/gi不同/a，/w一般/ad采用/v冗余/n备份/gi和/cc失效/vi转移/v解决/v高/a可用/v问题/gi。/w应用层/gi：/w一般/ad设计/gi为/p无/v状态/gi的/ude1，/w对于/p每次/r请求/gi，/w使用/gi哪/ry一/nz台/q服务器/gi处理/vn是/vshi没有/v影响/gi的/ude1。/w一般/ad使用/gi负载均衡/gi技术/gi（/w需要/v解决/vsession/gi同步/gi问题/gi）/w，/w实现/gi高/a可用/v。/w服务/gi层/gi：/w负载均衡/gi，/w分级管理/l，/w快速/d失败/vi（/w超时/v设置/gi）/w，/w异步/gi调用/gi，/w服务/gi降级/vi，/w幂/n等/udeng设计/gi等/udeng。/w数据层/nz：/w冗余/n备份/gi（/w冷/a，/w热备/nz[/nz同步/gi，/w异步/gi]/nz，/w温备/nz）/w，/w失效/vi转移/v（/w确认/v，/w转移/v，/w恢复/gi）/w。/w数据/gi高/a可用/v方面/n著名/a的/ude1理论/gi基础/gi是/vshicap/gi理论/gi（/w持久性/gi，/w可用性/gi，/w数据/gi一致性/gi[/nz强/a一致/a，/w用户/gi一致/a，/w最终/d一致/a]/nz）/w六/nz、/w可/v伸缩/vn架构/gi伸缩性/gi是/vshi指/v在/p不/d改变/v原有/v架构设计/nz的/ude1基础上/nz，/w通过/p添加/gi//nz减少/v硬件/gi（/w服务器/gi）/w的/ude1方式/n，/w提高/v//nz降低/v系统/gi的/ude1处理/vn能力/gi。/w应用层/gi：/w对/p应用/gi进行/vn垂直/gi或/c水平/n切分/v。/w然后/c针对/gi单一/gi功能/gi进行/vn负载均衡/gi（/wdns/nz,/nzhttp/gi[/nz反向代理/gi]/nz,/nzip/gi,/nz链路层/nz）/w。/w服务/gi层/gi：/w与/cc应用/gi层类/nz；/w数据层/nz：/w分库/gi，/w分表/n，/wnosql/gi等/udeng；/w常用算法/gihash/gi，/w一致性/gihash/gi。/w七/nz、/w可扩展/nz架构/gi可以/v方便/a的/ude1进行/vn功能模块/nz的/ude1新增/v//nz移除/v，/w提供/v代码/gi//nz模块/gi级别/n良好/a的/ude1可扩展性/gi。/w模块化/gi，/w组件化/vn：/w高内聚/nz，/w内/f耦合/vn，/w提高/v复用性/nz，/w扩展性/n。/w稳定/an接口/gi：/w定义/gi稳定/an的/ude1接口/gi，/w在/p接口/gi不变/nz的/ude1情况下/nz，/w内部结构/nz可以/v“/w随意/ad”/w变化/gi。/w设计模式/nz：/w应用/gi面向对象/gi思想/gi，/w原则/gi，/w使用/gi设计模式/nz，/w进行/vn代码/gi层面/n的/ude1设计/gi。/w消息队列/gi：/w模块化/gi的/ude1系统/gi，/w通过/p消息队列/gi进行/vn交互/gi，/w使/v模块/gi之间/f的/ude1依赖/v解耦/gi。/w分布式服务/n：/w公用/gi模块/gi服务化/n，/w提供/v其他/rzv系统/gi使用/gi，/w提高/v可/v重用性/nz，/w扩展性/n。/w八/nz、/w安全/gi架构/gi对/p已知/nz问题/gi有/vyou有效/gi的/ude1解决方案/gi，/w对/p未知/v//nz潜在/b问题/gi建立/gi发现/v和/cc防御机制/nz。/w对于/p安全问题/gi，/w首先/d要/v提高/v安全意识/nz，/w建立/gi一个/mq安全/gi的/ude1有效/gi机制/gi，/w从/p政策/n层面/n，/w组织/gi层面/n进行/vn保障/vn。/w比如/v服务器/gi密码/gi不能/v泄露/gi，/w密码/gi每月/r更新/gi，/w并且/c三次/nz内/f不能/v重复/gi；/w每周/r安全/gi扫描/gi等/udeng。/w以/p制度化/vi的/ude1方式/n，/w加强/v安全/gi体系/gi的/ude1建设/gi。/w同时/c，/w需要/v注意/v与/cc安全/gi有关/vn的/ude1各个环节/l。/w安全问题/gi不容忽视/vl。/w包括/v基础设施/gi安全/gi，/w应用/gi系统安全/nz，/w数据/gi保密/vn安全/gi等/udeng。/w基础设施/gi安全/gi：/w硬件/gi采购/vn，/w操作系统/gi，/w网络/gi环境/n方面/n的/ude1安全/gi。/w一般/ad采用/v，/w正规渠道/i购买/gi高质量/nz的/ude1产品/gi，/w选择/gi安全/gi的/ude1操作系统/gi，/w及时/ad修补/v漏洞/n，/w安装/gi杀毒软件/gi防火墙/gi。/w防范/gi病毒/gi，/w后门/n。/w设置/gi防火墙/gi策略/gi，/w建立/giddos/nz防御/gi系统/gi，/w使用/gi攻击/gi检测/gi系统/gi，/w进行/vn /x子网/gm隔离/vn等/udeng手段/n。/w /x应用/gi系统安全/nz：/w在/p程序开发/gi时/qt，/w对/p已知/nz常用/a问题/gi，/w使用/gi正确/a的/ude1方式/n，/w在/p代码/gi层面/n解决/v掉/v。/w防止/gi跨/v站/vi脚本/gi攻击/gi（/wxss/nz）/w，/w注入/gi攻击/gi，/w跨/v站/vi请求/gi伪造/v（/wcsrf/nz）/w，/w错误信息/nz，/whtml/gi注释/gi，/w文件/gi上传/v，/w路径/gi遍历/gi等/udeng。/w还/d可以/v使用/giweb应用/gi防火墙/gi（/w比如/v：/wmodsecurity/nz）/w，/w进行/vn安全漏洞/nz扫描/gi等/udeng措施/gi，/w加强/v应用/gi级别/n的/ude1安全/gi。/w /x数据/gi保密/vn安全/gi：/w存储/gi安全/gi（/w存在/v在/p可靠/a的/ude1设备/gi，/w实时/n，/w定时/d备份/gi）/w，/w保存/gi安全/gi（/w重要/a的/ude1信息/gi加密/gi保存/gi，/w选择/gi合适/a的/ude1人员/gi复杂/a保存/gi和/cc检测/gi等/udeng）/w，/w传输/gi安全/gi（/w防止/gi数据/gi窃取/v和/cc数据/gi篡改/gi）/w；/w /x常用/a的/ude1加解/nz密算法/nz（/w单项/n散列/nz加密/gi[/nzmd/nz5/nz,/nzsha/nz]/nz，/w对称加密/gi[/nzdes/nz,/nz3/nzdes/nz,/nzrc/nz]/nz）/w，/w非对称加密/gi[/nzrsa/gi]/nz等/udeng。/w九/nz、/w敏捷性/nz网站/gi的/ude1架构设计/nz，/w运维管理/gi要/v适应/v变化/gi，/w提供/v高/a伸缩性/gi，/w高/a扩展性/n。/w方便/a的/ude1应对/v快速/d的/ude1业务/gi发展/gi，/w突/vg增高/vi流量/gi访问/gi等/udeng要求/n。/w除/p上面/f介绍/gi的/ude1架构/gi要素/gi外/f，/w还/d需要/v引入/v敏捷/gi管理/gi，/w敏捷开发/gi的/ude1思想/gi。/w使/v业务/gi，/w产品/gi，/w技术/gi，/w运维/gi统一/vn起来/vf，/w随需应变/l，/w快速/d响应。十/nz、/w大型/b架构/gi举例/gi以上/f采用/v七层/nz逻辑/n架构/gi，/w第一层/nz客户/n层/gi，/w第二层/nz前端/gi优化层/nz，/w第三层/nz应用层/gi，/w第四层/nz服务/gi层/gi，/w第五层/nz数据/gi存储层/nz，/w第六层/nz大数据/gi存储层/nz，/w第七层/nz大/a数据处理层/nz。/w客户/n层/gi：/w支持/vpc/nz浏览器/gi和/cc手机/giapp/gi。/w差别/n是/vshi手机/giapp/gi可以/v直接/ad访问/gi通过/pip/gi访问/gi，/w反向/gi代理服务器/gi。/w前端/gi层/gi：/w使用/gidns/nz负载均衡/gi，/wcdn/gi本地/gi加速/gi以及/cc反向代理/gi服务/gi；/w应用层/gi：/w网站/gi应用/gi集群/gi；/w按照/p业务/gi进行/vn垂直/gi拆分/gi，/w比如/v商品/gi应用/gi，/w会员中心/n等/udeng；/w服务/gi层/gi：/w提供/v公用/gi服务/gi，/w比如/v用户服务/n，/w订单/gi服务/gi，/w支付/gi服务/gi等/udeng；/w数据层/nz：/w支持/v关系型数据库/gi集群/gi（/w支持/v读写/gi分离/vi）/w，/wnosql/gi集群/gi，/w分布式文件系统/nz集群/gi；/w以及/cc分布式/gicache/gi；/w大数据/gi存储层/nz：/w支持/v应用层/gi和/cc服务/gi层/gi的/ude1日志/gi数据/gi收集/v，/w关系数据库/gi和/ccnosql数据库/gi的/ude1结构化/n和/cc半结构/nz化/v数据/gi收集/v；/w大数据处理/gi层/gi：/w通过/pmapreduce/gi进行/vn离线/n数据分析/gi或/cstorm/nz实时/n数据分析/gi，/w并/cc将/d处理/vn后/f的/ude1数据/gi存入/v关系型数据库/gi。/w（/w实际/n使用/gi中/f，/w离线/n数据/gi和/cc实时/n数据/gi会/v按照/p业务/gi要求/n进行/vn分类/gi处理/vn，/w并/cc存入/v不同/a的/ude1数据库/gi中/f，/w供应/vn用/p层/gi或/c服务/gi层/gi使用/gi）/w。/w