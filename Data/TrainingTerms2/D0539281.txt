#打造/v先进/a的/ude1内存/giKV/nz数据库-/nz1/nz B/nz树/gi索引/gi的/ude1建立/gi（/w1/nz）/w
设计/gi目的/gi在/p搜索引擎/gi的/ude1设计/gi中/f，/w往往/d需要/v使用/gi倒排/v索引/gi，/w在/p当前/t内存价格/n不断/d走低/v的/ude1情况下/nz，/w内存数据库/gi必然/d会/v成为/v主流/gi。/wkv/nz数据库/gi由于/p适合/vmap/nz-/nzreduce/nz用于/v分布式/gi处理/vn。/w /x本/rz系统设计/gi实现/gi如下/vi目标/gi：/w /x*/nz /x实现/gi极/d高性能/gi的/ude1查询/gi /x*/nz /x实现/gi分布式/gi集群/gi储存/gi /x*/nz /x实现/gi可靠/a的/ude1日志/gi系统/gi索引/gi设计/gi索引/gi采用/vb/nz数/n索引/gi，/w这样/rzv做/v的/ude1目的/gi是/vshi大大/d利用/vcpu/gi的/ude1缓存/gi，/w让/v每个/r节点/gi的/ude1大小/n与/cccpu/gi二级缓存/nz相匹配/nz，/w另外/c，/w将/d索引值/nz连续/gi储存/gi在/p节点/gi中/f，/w可以/v减少/vtlb/nz失配/gi的/ude1次数/gi。/w由于/pb/nz树/gi的/ude1结构/gi，/w树高/nz不会/v太高/d，/w设想/vn在/p16/nzgb/nz的/ude1内存/gi中/f建立/gi数据库/gi，/w数据库/gi使用/gi8/nzg/nz内存/gi，/w每条/d记录/gi1/nzk/nz，/w那么/c就/d有/vyou8/nzm/nz个/q键/n，/w如果/c是/vshi每个/r节点/gi储存/gi256/nz个/q节点/gi的/ude1b/nz树/gi，/w那么/clog/gi256/nz(/nz8/nzm/nz)/nz=/nz3/nz,/nz树高/nz是/vshi3/nz，/w每次/r查询/gi节点/gi跳转/vi最多/ad2/nz次/qv，/w节点/gi内/f二分查找/gi是/vshi在/p高速缓存/gi中/f进行/vn，/w高速缓存/gi的/ude1效率/gi大约/d是/vshi装载/v内存/gi读取/gi的/ude14/nz~/nz5/nz倍/q（/w6000/nz次/qv查询/gi）/w，/w节点/gi内/f二分查找/gi的/ude1最大/gm次数/gi为/p8/nz次/qv，/w数据/gi可能/v可以/v优化/gi，/w在/p后续/vn实验/gi中/f进行/vn。/w /x对于/p为/p搜索引擎/gi定制/n的/ude1数据库/gi，/w对于/p插入/gi的/ude1性能/gi要求/n不是/c很高/d，/w之前/f做/v过/uguo的/ude1实验/gi表明/v，/w爬取/nz的/ude1性能/gi瓶颈/gi在于/v网络/giio/gi，/w网络/gi延迟/v远远/d大于/v数据库/gi插入/gi，/w故/c可以/v牺牲/v插入/gi性能/gi来/vf获得/v较高/ad的/ude1查询/gi性能/gi。/w代码实现/gi以下/f是/vshib/nz树/gi索引/gi的/ude1查询/gi以及/cc部分/n插入/gi实现/gi：/w单元测试/gi（/w未/d测试/gi多/a层/gi～/w待续/vi）/w