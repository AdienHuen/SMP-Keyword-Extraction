#持久化/nz机制/gi：/w
redis/gi是/vshi一个/mq支持/v持久化/nz的/ude1内存数据库/gi，/w也/d就/d说/vredis/gi需要/v经常/d将/d内存/gi中的/v数据/gi同步/gi到/v硬盘/gi来/vf保证/v持久化/nzredis/gi支持/v两/nz种/q持久化/nz方式/n：/w1./nzsnapshotting/nz（/w快照/gi）/w也/d是/vshi默认/v方式/n（/w将/d数据/gi存/v以/p快照/gi的/ude1方式/n写入/gi到/v二进制/gi文件/gi中/f）/w /x默认/v文件名/gidump/nz./nzrdb/gi可以/v通过/p配置/gi设置/gi自动/d做/v快照/gi持久化/nz的/ude1方式/n。/w我们/rr可以/v配置/giredis/gi在/pn/nz秒/qt内/f /x如果/c超过/vm/nz个/qkey/gi就/d自动/d做/v快照/gi。/w /x有/vyou时间/gi间隙/n，/w可能/v造成/v数据/gi损失/n2./nzappend/nz-/nzonly file/nz（/waof/gi）/w的/ude1方式/n（/w将/d操作/gi存到/v文件/gi中/f）/w /x由于/p快照/gi方式/n是/vshi在/p一定/b间隔时间/nz做/v一次/nz的/ude1，/w所以/credis/gi意外/adown/nz掉/v的话/udh，/w就/d会/v丢失/v最后/f一次/nz快照/gi后/f的/ude1 /x所有/b修改/gi aof/nz比/p快照/gi方式/n有/vyou更好/d的/ude1持久化/nz性/ng，/w是/vshi由于/p在/p使用/giaof/gi时/qtredis/gi会/v将/d每/rz一个/mq收到/v的/ude1写/v命令/gi通过/pwrite /nz函数/gi追加/v到/v文件/gi中/f。/w当/predis/gi重启/gi时会/n通过/p重新/d执行/v文件/gi中/f保存/gi的/ude1写/v命令/gi来/vf在/p内存/gi中/f重建/v整个/b数据库/gi的/ude1 /x内容/gi。/w由于/pos/gi会/v在/p内核/gi中/f缓存/giwrite/gi做/v的/ude1修改/gi，/w所以/c可能/v不是/c立即/d写到/v磁盘/gi上/f，/w这样/rzvaof/gi的/ude1持久化/nz也/d还是/c /x有可能/nz丢失/v部分/n修改/gi。/w可以/v通过/predis/gi我们/rr想要/v通过/pfsync/nz函数/gi强制/vdos/gi写入/gi到/v磁盘/gi的/ude1时机/n。/w /x