#Nginx/gi实现/giIIS/gi负载均衡/gi
又是/c一年/nz评教/nz时/qt /x今年/t我/rr负责/v一/nz所/usuo大学/gi的/ude1评教/nz任务/gi，/w所/usuo使用/gi的/ude1系统/gi是/vshi一/nz款/q三层/nz开发/gi的/ude1asp/nz.net/gi系统/gi。/w前/f几年/nz这/rzv所/usuo大学/gi都/d是/vshi使用/gi这款/r软件/gi来/vf支持/v评教/nz工作/gi的/ude1，/w以前/f的/ude1网站/gi部署/gi是/vshi这个/rz样子/n的/ude1：/w使用/gi一台/nz性能/gi比较/gi好/a的/ude1服务器/gi来/vf发布/gi网站/gi和/cc提供/v数据库/gi服务/gi。/w /x很容易/nz看/v出来/vf，/w这不/l符合/v单一/gi原则/gi。/w最好/d是/vshi一/nz台/q服务器/gi只/d负责/v提供/v一个/mq服务/gi，/w这/rzv样子/n比较/gi专业/n。/w前/f几年/nz这种/r部署/gi方式/n下/f系统/gi偶尔/d也/d会/v出现/v卡/n的/ude1情况/n /x。/w那么/c如何/ryv解决/v大数据量/gi和/cc高并发/gi的/ude1情况/n呢/y？/w为什么/ryv一/nz个人/n的/ude1活/v不能/v分给/v别人/rr干/v呢/y？/w道理/n是/vshi一样/uyy的/ude1，/w我们/rr用/pn/nz多/a台/q普通/a服务器/gi去/vf支持软件/n的/ude1运行/gi不/d就/d可以/v了/ule。/w经过/p我/rr查阅资料/gi，/w初步/d发现/v了/ule微软/ntc的/ude1web farm/nz和/cc俄罗斯/nsf的/ude1nginx/gi。/w不过/c了解到/v百度/ntc、/w腾讯/ntc等/udengit/gi巨头/n们/k都/d在/p使用/ginginx/gi，/w我/rr就/d选择/gi使用/gi nginx/nz了/ule。/w下面/f就/d开始/vnginx/gi之旅/nz吧/y！/w实战/gi应用/gi /x首先/d在/pa/nz服务器/gi上/f的/ude1iis/gi发布/gi评教/nz系统/gi，/w发布/gi地址/gi为/p：/w192.168.21.104/nz:/w8055。/nz在/pb/nz服务器/gi上/f的/ude1iis/gi上/f发布/gi同样/d的/ude1评教/nz系统/gi，/w发布/gi地址/gi为/p /x：/w192.168.21.125/nz:/w8056。/nz然后/c在/p另外/c一台/nz电脑/gi上/f配置/gi好/anginx/gi后/f，/w运行/ginginx/gi，/w监听/gi地址/gi：/w192.168.21.88/nz:/w8090。/nz本次/r测试/gi在/pnginx/gi中/f配置/gi均衡/a规则/gi为/p1/nz:/w1/nz /x实际/n运行/gi过程/gi中/f，/w真是/d出乎意料/vl。/w首先/d出错/gi：/wiis/gi验证/v视图/gi状态/gimac/gi失败/vi，/w好/a吧/y，/w有/vyou问题/gi及时/ad解决/v，/w经查/nz是/vshi由于/pasp/nz.net/gi自身/rr安全/gi上/f的/ude1设计/gi，/w这个/rz功能/gi集成/vn到/viis/gi中/f了/ule。/w好/a吧/y，/w查/v了/ule半天/mq没有/v看懂/nz。。。/w不过/c其中/rz一个/mq现象/n很/d诡异/a：/w有时候/d不/d报出/v这个/rz错误/gi，/w有时候/d报/n这个/rz错/v。/w差不多/al这样/rzv的/ude1比例/n也/d是/vshi1/nz:/w1。/nz后来/t通宵/n加班/vi也/d没有/v解决/v这个/rz问题/gi，/w就/d在/p选择/gi放弃/gi的/ude1时候/n，/w无意间/d看/v了/ule一/nziis/gi，/w头脑/n中/f闪现/v出/vf一个/mq解决方案/gi。/w进入/v之后/f是/vshi这个/rz样子/n的/ude1：/w /x这里/rzs注意/v：/w每个/riis/gi服务器/gi的/ude1密钥/gi必须/d是/vshi一样/uyy的/ude1，/w而且/c不能/v自动/d变化/gi。/w我/rr是/vshi这样/rzv操作/gi的/ude1，/w先/d由/p一台/nziis/gi服务器/gi生成/v固定/a的/ude1密钥/gi，/w然后/c拷贝到/nz其他/rzviis/gi服务器/gi上/f。/w /x好/a了/ule，/wmac/gi的/ude1问题/gi解决/v了/ule，/w然后/c又/d开始/v出/vf问题/gi了/ule，/w每次/r输入/v验证码/gi时/qt，/w明明/d我/rr输入/v的/ude1是/vshi对/p的/ude1，/w就/d告诉/v我/rr验证码/gi错误/gi，/w请/v重新/d输入/v！/w不行/a我/rr抓狂/nz了/ule，/w你/rr妹/n啊/y！/w然后/c诡异/a的/ude1事情/n继续/v发生/v着/uzhe，/w一般/ad的/ude1机会/gi能/v正常/a进入/v，/w一般/ad的/ude1机会/gi不能/v进入/v。/w /x这/rzv说明/v首次/mq相应/vi给/p客户端/gi浏览器/gi登录/gi界面/gi的/ude1iis/gi服务器/gi，/w下次/t登录/gi请求/gi如果/cnginx/gi还/d分配/gi到/v这个/rziis/gi服务器/gi，/w那么/c就/d能/v正常/a登录/gi，/w否则/c，/w不能/v正常/a登录/gi。/w /x又/d经/p我/rr查阅资料/gi和/cc源代码/gi，/w发现/v其实/d是/vshi如果/c做成/v了/ule服务器/gi集群/gi，/w那么/csession/gi共享/gi就是/v一个/mq问题/gi。/w而/cc我/rr遇到/v的/ude1这个/rz问题/gi正是/v典型/n的/ude1session/gi不能/v共享/gi的/ude1问题/gi。/w那么/c如何/ryv实现/gisession/gi共享/gi呢/y？/w其实/d实现/gisession/gi共享/gi有/vyou很/d多方法/nz，/w因为/c我/rr使用/gi的/ude1是/vshisqlserver/gi数据库/gi，/w微软/ntc已经/d在/psqlserver/gi为/p我们/rr想到/v了/ulesession/gi共享/gi的/ude1需求/gi了/ule。/w /x先/d执行/v微软/ntc已经/d为/p你/rr写/v好/a的/ude1一个/mqsql/gi脚本/gi，/w创建/gi存储/gisession/gi的/ude1数据库/gi。/w修改/gi刚才/t生成/v的/ude1数据库/gi的/ude1一个/mq存储过程/gi，/w因为/c我/rr只/d运行/gi一个/mq网站/gi，/w所以/c需要/v这样/rzv修改/gi。/w开启/giasp/nz./nznet service/nz,/nz该/rz服务/gi默认/v为/p手动/b启动/gi，/w所以/c最好/d改为/v自动/d启动/gi。/w最后/f需要/v配置/gi一下/m我们/rr的/ude1网站/gi，/w告诉/v我们/rr的/ude1网站/gi把/pbasession/gi存储/gi在/p数据库/gi的/ude1特定/b表/n中/f。/w在/p配置文件/gi相应/vi位置/gi插入/gi下面/f这/rzv句话/q：/w好/a了/ule，/w这样/rzv我们/rr伟大/a的/ude1负载均衡/gi的/ude1实现/gi就/d搞定/v了/ule！/w一路/m走来/v都/d感觉/gi累/a了/ule，/w看看/v整体/n上/f系统/gi是/vshi /x如何/ryv运行/gi的/ude1吧/y。/w收获/gi总结/gi感恩/vi每/rz一个/mq跟/p你/rr合作/vn的/ude1人/n，/w这次/r技术/gi研究/gi多亏/v了/ule张晗/nz同学/n的/ude1鼎力相助/vl！/w在/p任何/rz场合/n都/d能/v发现/v让/v你/rr学习/gi提高/v的/ude1机会/gi，/w做/v一个/mq善于/v发现/v机会/gi并且/c善于/v把握/gi机会/gi的/ude1人/n。/w