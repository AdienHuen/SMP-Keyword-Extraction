#笔试/gi：/w天猫/nt魔盒/nz下单/n问题/gi
s/nz天猫/nt双十一/nz有/vyou个/q积分换/v墨盒/n的/ude1活动/gi，/w总共/d有/vyou50/nz万/nz台/q天猫/nt魔盒/nz（/wbox/nz）/w，/w每个/r用户/gi（/wuser/gi）/w可以/v用/p99/nz个/q天猫/nt积分/n（/wpoint/nz）/w兑换/v一/nz台/q魔盒/nz，/w且/c每人/r限换/nz一台/nz。/w请/v设计/gi一套/nzjava接口/gi并/cc实现/gi下单/n（/worder/nz）/w逻辑/n。/w参考/gi（/w但/c不/d局限于/v）/w下面/f的/ude1下单/n逻辑/n：/w1/nz、/w创建/gi订单/gi2/nz、/w扣减/nz用户/gi积分/n3/nz、/w扣减/nz魔盒/nz库存/gi4/nz、/w下单/n成功/a同时/c请/v回答/v：/w1/nz、/w数据库表/gi结构/gi如何/ryv设计/gi，/w有/vyou哪些/ry表/n，/w分别/d有/vyou什么/ry作用/gi？/w2/nz、/w下单/n过程/gi中/f哪些地方/nz可能/v成为/v瓶颈/gi？/w如何/ryv解决/v或/c改善/v？/w3/nz、/w是否/v会用/n到/v数据库/gi事务/gi，/w哪些地方/nz会用/n到/v？/w如果/c不用/d数据库/gi事务/gi，/w如何/ryv保证数据/n的/ude1一致性/gi？/w首先/d，/w我们/rr考虑到/v实体/n有/vyou用户/gi类/gi和/cc魔盒/nz类/gi，/w用户/gi和/cc魔盒/nz之间/f涉及/v到/v交易/gi，/w即/v每次/r交易/gi生成/v一个/mq订单/gi。/w对应/vi的/ude1包含/v三个/nz数据表/gi，/w包含/v的/ude1必要/a属性/gi。/w /x用户/gi（/w用户/giid/nz，/w用户名/n，/w天猫/nt积分/n）/w /x魔盒/nz（/w魔盒/nzid/nz，/w魔盒/nz名称/n，/w魔盒/nz积分/n，/w库存/gi数量/n，/w总/b数量/n）/w /x订单/gi（/w订单/giid/nz，/w用户/giid/nz，/w订单/gi时间/gi，/w订单/gi状态/gi）/w下单/n过程/gi中的/v瓶颈/gi /x数据库/gi写/v操作/gi问题/gi，/w主要/b集中/v在/p对/p魔盒/nz数量/n的/ude1读写/gi问题/gi。/w对/p魔盒/nz库存/gi操作过程/l中/f使用/gi线程同步/gi。/w /x是否/v数据库/gi事务/gi，/w用/p到/v了/ule。/w事务/gi是/vshi一/nz组/n原子性/nz的/ude1sql/gi查询/gi。/w在/p该/rz操作/gi中/f，/w涉及/v到/v到/v的/ude1事物/n，/w减/v积分/n，/w减/v魔盒/nz库存/gi，/w添加/gi订单/gi，/w其中/rz任意/d操作/gi失败/vi，/w那么/c事务/gi中的/v所有/b操作/gi都/d不会/v执行/v。/wa/nz公司/nis打算/gi搭建/v一个/mqandroid app/nz下载/gi的/ude1web/gi站点/gi，/w计划/gi将/d目前/t常见/a的/ude1手机/giapp/gi都/d放到/v这个/rz网站/gi上/f提供/v下载/gi。/w因为/c业务/gi开展/v初期/f下载量/l很小/a，/w技术/gi部门/gi就/d用/p了/ule1/nz台/q服务器/gi，/w给/p服务器/gi配置/gi了/ule一个/mq公网/nzip/gi对外/vn进行/vn服务/gi。/w随着/p销售/gi部门/gi的/ude1推广/gi到位/vi，/w用户量/n和/cc下载量/l呈/v指数级/nz上载/v，/w要求/n技术/gi部门/gi马上/d进行/vn改造/vn。/w如果/c你/rr是/vshi技术/gi部门经理/nnt，/w你/rr会/v怎么/ryv改造/vn这个/rz站点/gi，/w以/p满足/v高/a负载/gi的/ude1需求/gi。/w /x提示/gi：/w短时间/nz修改/gi网站/gi的/ude1代码/gi不/d现实/n，/w其他/rzv方面/n的/ude1各种/rz改造/vn建议/gi都/d可以/v，/w建议/gi越多越好/l。/w /x1./nz对/papp/gi资源/gi进行/vn多/a服务器/gi备份/gi，/w在/p每个/r下载/gi页面/gi新增/v多/a个/q下载/gi通道/n。/w  /x2./nz新增/v在/p下载/gi时/qt,/nz需/v校验/v图像/gi验证码/gi，/w确保/v用户/gi确实/ad要/v下载/gi内容/gi。/w /x3./nz资源/gi重定向/gi：/w增加/vn/nz台/q内部/f服务器/gi，/w组成/gi一个/mq局域网/gi，/w将/dapp/gi复制/gin/nz份/q放到/v内部/f服务器/gi中/f，/w原来/d的/ude1服务器/gi作为/p与/cc因特网/gi通信/gi的/ude1接口/gi。/w当/p原/b服务器/gi收到/v客户端/gi请求/gi后/f，/w服务器/gi选择/gi一个/mq负载/gi最小/a的/ude1内部/f服务器/gi，/w将/d客户端/gi的/ude1请求/gi重定向/gi到/v该/rz服务器/gi /x。/w /x转载/v链接/gi：/w                   /x