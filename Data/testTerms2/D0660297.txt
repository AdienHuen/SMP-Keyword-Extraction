#嵌入式/gi协议/gi栈/gi开发/gi问题/gi【/w软定/nz时器/nz实现/gi】/w
嵌入式/gi开发/gi中/f，/w硬件/gi定时器/gi资源/gi通常/d非常/d有限/a，/w而/cc协议/gi栈/gi中/f需要/v的/ude1定时/d功能/gi会/v比较/gi多/a，/w下面/f简单/a介绍/gi下/f自己/rr的/ude1想法/gi：/w背景/n：/w利用/vmcu/nz的/ude1一个/mq定时器/gi，/w模拟出/n多/a个/q软件/gi定时器/gi。/w1/nz /x全局/n结构体/gi用于/v存储/gi软件/gi定时/d的/ude1参数/gi，/w如/v当前/t时间/gi，/w定时/d时间/gi，/w触发/gi时间/gi，/w函数指针/nz等/udeng；/w2/nz /x软定/nz时器/nz设置/gi入口/n函数/gi，/w传入/gi要/v定时/d的/ude1时间/gi与/cc回调/gi函数/gi；/w3/nz /x软定/nz时器/nz设置/gi入口/n函数/gi中/f，/w对/p各个/rz配置/gi的/ude1触发/gi时间/gi进行/vn优先级/n排序/gi，/w最先/d触发/gi的/ude1优先级/n最高/a；/w4/nz /x软定/nz时器/nz设置/gi入口/n函数/gi中/f，/w根据/p优先级/n最高/a的/ude1触发/gi时间/gi戳/v，/w配置/gi下/f一次/nz硬件/gi定时器/gi将要/d触发/gi的/ude1时刻/n；/w5/nz /x硬件/gi定时器/gi触发/gi完成/v后/f，/w寻找/v下一个/nz优先级/n最高/a的/ude1将要/d触发/gi的/ude1结构体/gi；/w6/nz /x定时器/gi触发/gi后/f，/w调用/gi对应/vi的/ude1回调/gi函数/gi即可/v；/w7/nz /x取消/v某个/rz软定/nz时器/nz时/qt，/w修改/gi全局/n的/ude1定时器/gi结构体/gi参数/gi，/w并/cc使/v对应/vi的/ude1软/a定时器/gi失效/vi。/w大家/rr尽情/d拍砖/nz，/w不足之处/i不吝/v指点/v，/w共同进步/l。/w