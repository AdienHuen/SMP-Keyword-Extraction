#Exchange Server /nz2013/nz系列五/nz：/w虚拟化/gi部署/gi
原文/n地址/gi：/w作者/nnt：/wdufei/nz作者/nnt声明/gi：/w原创/b作品/n，/w允许/v转载/v，/w转载/v时/qt请/v务必/d以/p超链接/gi形式/gi标明/v文章/gi /x原始/a出处/n /x、/w作者/nnt信息/gi和/cc本/rz声明/gi。/w否则/c将/d追究/v法律责任/nz。/w /x虚拟化/gi正/d成为/v一种/nz趋势/gi，/w被/pbei越来越/d多/a的/ude1企业/gi所/usuo接受/gi，/w本文/r只是/d对/pexchange/gi服务器虚拟化/gi的/ude1要点/n进行/vn梳理/v，/w以/p便于/v总结/gi回顾/v：/w硬件/gi虚拟化/gi要求/n：/w /x目前/t市场/gi上有/v存在/v不同/a的/ude1硬件/gi虚拟化/gi解决方案/gi，/w当然/d在/p此/rzs主要/b推荐/gi使用/gi微软/ntc的/ude1hyper/nz-/nzv/nz，/wexchange /nz2013/nz虚拟机/gi系统/gi需要/v部署/gi在/pwindows server /nz2008/nz r/nz2/nz sp/nz1/nz（/w或/c更高/d版本/n）/w、/wwindows server /nz2012/nz /x或/c windows server /nz2012/nz r/nz2/nz /x上/f。/w按照/p微软/ntc的/ude1官方/gi指导/vn，/w有/vyou以下几点/l需要/v说明/v：/w1./nz /x只/d需要/v一个/mq虚拟机/gi就/d可以/v支持/v所有/bexchange /nz2013/nz的/ude1服务器/gi角色/gi。/w2./nz exchange /nz虚拟机/gi是/vshi支持/v基本/a主机/gi的/ude1故障/gi转移/v群集/n和/cc迁移/gi技术/gi的/ude1。/w只要/c将/d虚拟机/gi配置/gi为/p在/p移动/vn或/c脱机/gi时/qt不在/v磁盘/gi上/f保存/gi和/cc还原/gi状态/gi，/wexchange server /nz虚拟机/gi（/w包括/v属于/v数据库/gi可用性/gi组/n /x(/nzdag/nz)/nz /x的/ude1 exchange /nz邮箱/n虚拟机/gi）/w就/d可以/v与/cc基于/p主机/gi的/ude1故障/gi转移/v群集/n和/cc迁移/gi技术/gi结合/v。/w如果/c在/p目标/gi节点/gi上/f激活/gi了/ule虚拟机/gi，/w则/d所有/b在/p虚拟机/gi管理程序/gi级别/n发生/v的/ude1故障/gi转移/v活动/gi必然/d导致/gi冷启动/gi，/w如果/c采用/v了/ule microsoft hyper/nz-/nzv/nz，/w则/d支持/v实时/n迁移/gi选项/gi，/w但/c不/d支持/v快速/d迁移/gi选项/gi。/w必须/d注意/v的/ude1是/vshi，/w在/p hyper/nz-/nzv /nz环境/n中的/v虚拟/gi机上/s选择/gi“/w移动/vn”/w操作/gi时/qt，/w默认/v行为/n实际上/d是/vshi执行/v快速/d迁移/gi。/w但/c就其/d目前/texchange /nz角色/gi都/d可以/v实现/gi自身/rr高/a可用/v，/w不/d建议/gi使用/gi故障/gi转移/v群集/n或者/c是/vshi迁移/gi技术/gi。/w3./nz /x虚拟机/gi快照/gi有/vyou好处/gi，/w但/c不适/a用于/vexchange/gi这样/rzv的/ude1关键/n服务器/gi，/w应用程序/nz本身/rz无法/v识别/gi虚拟机/gi快照/gi，/w使用/gi这些/rz快照/gi可能会/nz导致/gi维护/gi状态/gi数据/gi的/ude1服务器应用程序/n（/w例如/v exchange/nz）/w出现意外/l结果/n。/w因此/c，/w不/d推荐/gi为/p exchange /nz来宾/n虚拟机/gi建立/gi虚拟机/gi快照/gi。/w总之/c，/w生产/gi环境/n中/f尽量减少/i使用/gi快照/gi。/w4./nz /x处理器/gi的/ude1分配原则/n，/w来宾/n虚拟机/gi中的/v虚拟/gi处理器/gi共享/gi物理/n系统/gi中/f一定/b数量/n的/ude1逻辑/n处理器/gi。/wexchange /nz支持/v的/ude1虚拟/gi处理器/gi与/cc逻辑/n处理器/gi之比/ns不得/vi超过/v /x2/nz:/w1/nz，/w但/c我们/rr建议/gi的/ude1比例/n为/p /x1/nz:/w1。/nz例如/v，/w如果/c某个/rz双处理器/n系统/gi使用/gi的/ude1是/vshi16/nz核/n处理器/gi，/w则/d该/rz处理器/gi在/p主机/gi系统/gi中/f总共/d有/vyou /x32/nz /x个/q逻辑/n处理器/gi。/w在/p使用/gi此/rzs配置/gi的/ude1系统/gi中/f，/w建议/gi不要/d将/d总数/n超过/v /x32/nz /x个/q的/ude1虚拟/gi处理器/gi分配/gi给/p组合/gi在/p一起/s的/ude1所有/b来宾/n虚拟机/gi，/w但/c最多/ad不/d支持/v64/nz个/q虚拟/gi处理器/gi，/w即/v虚拟/gi处理器/gi总数/n与/cc物理/n内核/gi之比/ns是否/v不/d超过/v /x2/nz:/w1/nz，/w不是/c说/v不能/v用/p，/w是/vshi性能/gi会/v受到影响/v。/w5./nz exchange /nz来宾/n计算机/gi的/ude1操作系统/gi使用/gi的/ude1磁盘/gi的/ude1大小/n必须/d至少/d等于/v /x15/nz gb /nz外加/v分配/gi给/p该/rz来宾/n计算机/gi的/ude1虚拟内存/gi大小/n。/w此/rzs要求/n必须/d考虑/v操作系统/gi和/cc页面/gi文件/gi磁盘/gi的/ude1要求/n。/w例如/v，/w如果/c来宾/n计算机/gi分配/gi的/ude1内存/gi为/p /x16/nz gb/nz，/w则/d来宾/n操作系统/gi所需/nz的/ude1最低/a磁盘空间/nz为/p /x31/nz gb/nz。/w就其/d现在/t条件/n来说/uls，/w都/d可以/v达到/v此/rzs要求/n。/w物理/n主机/gi的/ude1存储/gi要求/n：/w每个/r主机/gi的/ude1最低/a磁盘空间/nz要求/n如下/vi所示/nz：/w1./nz /x某些/rz硬件/gi虚拟化/gi应用程序/nz中的/v主机/gi可能/v需要/v存储空间/gi来/vf存储/gi操作系统/gi及其/cc组件/gi。/w例如/v，/w运行/gi采用/v hyper/nz-/nzv /nz技术/gi的/ude1 windows server /nz2008/nz r/nz2/nz，/w至少/d需要/v /x10/nz gb /nz空间/n才能/n满足/v windows server /nz2008/nz /x的/ude1要求/n。/w此外/c，/w还/d需要/v额外/b的/ude1存储空间/gi来/vf支持/v操作系统/gi的/ude1页面/gi文件/gi、/w管理软件/nz和/cc崩溃/vi恢复/gi（/w转储/gi）/w文件/gi。/w2./nz /x有些/rz管理程序/gi将/d维护/gi主机/gi中/f每个/r来宾/n虚拟机/gi所/usuo特有/b的/ude1文件/gi。/w例如/v，/w在/p hyper/nz-/nzv /nz环境/n中/f，/w系统/gi将/d为/p每个/r来宾/n计算机/gi创建/gi并/cc维护/gi临时/gi内存/gi存储/gi文件/gi /x(/nzbin /nz文件/gi)/nz。/w每个/r bin /nz文件/gi的/ude1大小/n等于/v分配/gi给/p该/rz来宾/n计算机/gi的/ude1内存/gi量/n。/w此外/c，/w系统/gi还/d会/v在/p主机/gi中/f为/p每个/r来宾/n计算机/gi创建/gi并/cc维护/gi其他/rzv文件/gi。/w也/d就是说/c，/w在/p满足/v虚拟机/gi存储空间/gi需求/gi的/ude1前提/n下/f还/d需要/v为/p每个/r虚拟机/gi加上/vbin/nz文件/gi的/ude1容量/gi。/wexchange/gi来宾/n系统/gi要求/n：/w1./nz /x存储/gi要求/n：/wexchange /nz来宾/n计算机/gi用于/v存储/gi exchange /nz数据/gi（/w例如/v，/w邮箱/n数据库/gi和/cc传输/gi队列/gi）/w的/ude1存储空间/gi可以/v为/p固定/a大小/n的/ude1虚拟/gi存储空间/gi（/w例如/v，/whyper/nz-/nzv /nz环境/n中的/v固定/a虚拟/gi硬盘/gi /x(/nzvhd/nz)/nz）/w、/wscsi /nz共享/gi存储空间/gi或/c internet scsi /nz(/nziscsi/nz)/nz /x存储空间/gi。/w共享/gi存储/gi是/vshi指/v在/p主机/gi级别/n中/f配置/gi的/ude1、/w专/a用于/v某/rz一/nz来宾/n计算机/gi的/ude1存储/gi。/wexchange /nz来宾/n计算机/gi用于/v存储/gi exchange /nz数据/gi的/ude1所有/b存储空间/gi必须/d为/p块/q级/q存储空间/gi。/w2./nz /x内存/gi要求/n：/w /x某些/rz虚拟机/gi监控/gi程序/gi能够/v基于/p特定/b来宾/n计算机/gi中/f内存/gi的/ude1感知/gi利用率/n与/cc相同/a虚拟机/gi监控/gi程序管理/n的/ude1其他/rzv来宾/n计算机/gi需求/gi的/ude1比较/gi情况/n，/w来/vf过量/vi订阅/v或/c动态/gi调整/vn对/p该/rz来宾/n计算机/gi可用/v的/ude1内存/gi量/n。/w此/rzs技术/gi适用/vi于/p短时间/nz内/f需要/v内存/gi，/w随后/d可以/v向/p其他用户/l交出/v内存/gi的/ude1工作/gi负载/gi。/w但是/c不适/a用于/v旨在/v持续/vd使用/gi内存/gi的/ude1工作/gi负载/gi。/w与/cc具有/v涉及/v在/p内存/gi中/f缓存数据/n的/ude1性能优化/gi的/ude1许多服务器/nz应用程序/nz一样/uyy，/wexchange /nz在/p无法/v完全/ad控制/vn分配/gi给/p运行/gi其/rz的/ude1物理/n计算机/gi或/c虚拟机/gi的/ude1内存/gi时/qt，/w容易/ad形成/v糟糕/a的/ude1系统/gi性能/gi和/cc不可/v接受/gi的/ude1客户端/gi体验/v。/w因此/c，/w不/d支持/v对/p exchange /nz使用/gi动态内存/nz功能/gi。/w本文/r出自/v /x“”/nz /x博客/gi，/w请/v务必/d保留/v此/rzs出处/n